<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 1: Creating the Store Manager controller and its Index view" />
      <MSHelp:RLTitle Title="Exercise 1: Creating the Store Manager controller and its Index view" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 1: Creating the Store Manager controller and its Index view</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">ASP.NET MVC 3 Helpers, Forms and Validation</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 1: Creating the Store Manager controller and its Index view</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>In this exercise, you will learn how to create a new controller to support CRUD operations, customize its Index action method to return a list of albums from the database and finally generating an Index View template taking advantage of ASP.NET MVC’s scaffolding feature to display the albums’ properties in an HTML table.</p>
        <a name="_Task_1_–" href="#">
          <span />
        </a>
        <a name="_Toc182141331" href="#">
          <span />
        </a>
        <a name="_Toc223343086" href="#">
          <span />
        </a>
        <a name="_Toc247341950" href="#">
          <span />
        </a>
        <a name="_Toc259103753" href="#">
          <span />
        </a>
        <a name="_Toc268709022" href="#">
          <span />
        </a>
        <a name="_Toc269992843" href="#">
          <span />
        </a>
        <a name="_Toc282517405" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Creating the StoreManagerController</b>
        </p>
        <p>In this task, you will create a new controller called <b>StoreManagerController</b> to support CRUD operations.</p>
        <ol>
          <li>Start Microsoft Visual Web Developer 2010 Express from <b>Start</b> | <b>All Programs</b> | <b>Microsoft Visual Studio 2010 Express </b>| <b>Microsoft Visual Web Developer 2010 Express</b>.</li>
          <li>In the <b>File</b> menu, choose <b>Open Project</b>. In the Open Project dialog, browse to Source\Ex01-CreatingTheStoreManagerController\Begin, select <b>MvcMusicStore.sln</b> and click <b>Open</b>.</li>
          <li>Add the new controller. To do this, right-click the <b>Controllers</b> folder within the Solution Explorer, select <b>Add</b> and then the <b>Controller</b> command. Change the <b>Controller</b><b>Name</b> to <b>StoreManagerController</b> and make sure that the checkbox <b>Add action methods for Create, Update, Delete, and Details scenarios</b> is checked. Click <b>Add</b>.<p><img src="images\2ce67f78-e2b2-409d-8037-dca573cf8317.png" /></p><p><b>Figure 1</b><br /><i>Add Controller Dialog</i></p><br /></li>
          <li>A new Controller class is generated. Since you indicated to <b>add action methods for Create, Update, Delete, and Details scenarios</b>, stub methods for those, common CRUD actions are created with TODO comments filled in, prompting to include the application specific logic.</li>
          <li>Since you don’t need the Details Controller action, delete that method.</li>
        </ol>
        <a name="_Toc269992844" href="#">
          <span />
        </a>
        <a name="_Toc282517406" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Customizing the StoreManager Index</b>
        </p>
        <p>In this task, you will customize the StoreManager Index action method to return a View with the list of albums from the database.</p>
        <ol>
          <li>Add a using directive to <b>MvcMusicStore.Models</b>:<p>(Code Snippet – ASP.NET MVC 3 Helpers and Forms and Validation – Ex1 using MvcMusicStore – CSharp)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>using System.Web.Mvc;<b>using MvcMusicStore.Models;</b></pre></td></tr></table></span></div><br /></li>
          <li>Add a field to the <b>StoreManagerController</b> to hold an instance of <b>MusicStoreEntities.</b><p>(Code Snippet – ASP.NET MVC 3 Helpers and Forms and Validation – Ex1 MusicStoreEntities – CSharp)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class StoreManagerController : Controller{<b>    MusicStoreEntities storeDB = new MusicStoreEntities();</b></pre></td></tr></table></span></div><br /></li>
          <li>Implement the <b>StoreManagerController</b><b>Index</b> action to return a View with the list of albums. The Controller action logic will be very similar to the StoreController’s Index action written earlier. Use LINQ to retrieve all albums, including Genre and Artist information for display.<p>(Code Snippet – ASP.NET MVC 3 Helpers and Forms and Validation – Ex1 StoreManagerController Index – CSharp)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>//// GET: /StoreManager/public ActionResult Index(){<b>    var albums = storeDB.Albums</b><b>        .Include("Genre").Include("Artist")</b><b>        .ToList();</b><b>    return View(albums);</b>}</pre></td></tr></table></span></div><br /></li>
        </ol>
        <a name="_Toc269992845" href="#">
          <span />
        </a>
        <a name="_Toc282517407" href="#">
          <span />
        </a>
        <p>
          <b>Task 3 – Creating the Index View</b>
        </p>
        <p>In this task, you will create the Index View template to display the list of albums returned by the <b>StoreManager</b> Controller.</p>
        <ol>
          <li>Before creating the new View template, you should build the project so that the <b>Add View Dialog</b> knows about the <b>Album</b> class to use. Build the project by selecting the <b>Debug</b> menu item and then <b>Build MvcMusicStore</b>.<p><img src="images\08e692a3-5ca0-45ff-b68d-4d5db0ee9efa.png" /></p><p><b>Figure 2</b><br /><i>Building the project</i></p><br /></li>
          <li>Right-click inside the <b>Index</b> action method and select <b>Add View</b>. This will bring up the Add View dialog.<p><img src="images\02319743-ab57-4bc1-bd58-1162ea88d78b.png" /></p><p><b>Figure 3</b><br /><i>Adding a View from within the Index method</i></p><br /></li>
          <li>In the Add View dialog, verify that the View Name is <b>Index</b>. Check the <b>Create a strongly-typed view</b> checkbox and select <b>Album (MvcMusicStore.Models) </b>from the<b> View data class</b> drop-down. Select <b>List</b> from the <b>View content</b> drop-down. Leave the <b>View Engine </b>to<b> ASPX (C#) </b> and the other fields with their default value and then click <b>Add</b>.<p><img src="images\c416eb5a-0a6b-411e-a75e-2106109c230c.png" /></p><p><b>Figure 4</b><br /><i>Adding an Index View</i></p><br /></li>
        </ol>
        <a name="_Toc269992846" href="#">
          <span />
        </a>
        <a name="_Toc282517408" href="#">
          <span />
        </a>
        <p>
          <b>Task 4 – Customizing the scaffold of the Index View</b>
        </p>
        <p>In this task, you will adjust the simple View template created with ASP.NET MVC scaffolding feature to have it display the fields you want.</p>
        <div class="alert">
          <table width="100%" cellspacing="0" cellpadding="0">
            <tr>
              <th align="left">
                <img class="note" src="../local/note.gif" />Note:</th>
            </tr>
            <tr>
              <td> The <b>scaffolding</b> support within ASP.NET MVC generates a simple View template which lists all fields in the Album model. <b>Scaffolding</b> provides a quick way to get started on a strongly typed view: rather than having to write the View template manually, scaffolding quickly generates a default template and then you can modify the generated code.</td>
            </tr>
          </table>
          <p />
        </div>
        <br />
        <ol>
          <li>Review the code created. The generated list of fields will be part of the following HTML table that <b>Scaffolding</b> is using for displaying tabular data.<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>HTML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;table&gt;    &lt;tr&gt;        &lt;th&gt;&lt;/th&gt;        &lt;th&gt;            GenreId        &lt;/th&gt;        &lt;th&gt;            ArtistId        &lt;/th&gt;        &lt;th&gt;            Title        &lt;/th&gt;        &lt;th&gt;            Price        &lt;/th&gt;        &lt;th&gt;            AlbumArtUrl        &lt;/th&gt;    &lt;/tr&gt;&lt;% foreach (var item in Model) { %&gt;    &lt;tr&gt;        &lt;td&gt;            &lt;%: Html.ActionLink("Edit", "Edit", new { id=item.AlbumId }) %&gt; |            &lt;%: Html.ActionLink("Details", "Details", new { id=item.AlbumId }) %&gt; |            &lt;%: Html.ActionLink("Delete", "Delete", new { id=item.AlbumId }) %&gt;        &lt;/td&gt;        &lt;td&gt;            &lt;%: item.GenreId %&gt;        &lt;/td&gt;        &lt;td&gt;            &lt;%: item.ArtistId %&gt;        &lt;/td&gt;        &lt;td&gt;            &lt;%: item.Title %&gt;        &lt;/td&gt;        &lt;td&gt;            &lt;%: String.Format("{0:F}", item.Price) %&gt;        &lt;/td&gt;        &lt;td&gt;            &lt;%: item.AlbumArtUrl %&gt;        &lt;/td&gt;    &lt;/tr&gt;  &lt;% } %&gt;&lt;/table&gt;</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> the generated template is following the same coding practices you have seen at ASP.NET MVC Fundamentals Hands-on lab: <b>&lt;%: %&gt;</b> code nuggets to HTML encode values, and <b>Html.ActionLink()</b> helper method to generate links to other controller actions.</td></tr></table><p /></div><br /></li>
          <li>Display only the <b>Album Title</b>, <b>Artist</b>, and <b>Genre</b> fields. To do this, delete the <b>AlbumId</b>, <b>Price</b> and <b>Album Art URL</b> columns. Also, change GenreId and ArtistId columns to display their linked class properties of <b>Artist.Name</b> and <b>Genre.Name</b>. Finally, remove the <b>Details</b> link.<p>To do this, replace the <b>&lt;table&gt;</b> code with the following:</p><div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>HTML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>&lt;table&gt;</b><b>    &lt;tr&gt;</b><b>        &lt;th&gt;&lt;/th&gt;</b><b>        &lt;th&gt;Title&lt;/th&gt;</b><b>        &lt;th&gt;Artist&lt;/th&gt;</b><b>        &lt;th&gt;Genre&lt;/th&gt;</b><b>    &lt;/tr&gt;</b><b>&lt;% foreach (var item in Model) { %&gt;</b><b>    &lt;tr&gt;</b><b>        &lt;td&gt;</b><b>            &lt;%: Html.ActionLink("Edit", "Edit", new { id=item.AlbumId }) %&gt; |</b><b>            &lt;%: Html.ActionLink("Delete", "Delete", new { id=item.AlbumId })%&gt;</b><b>        &lt;/td&gt;</b><b>        &lt;td&gt;&lt;%: item.Title %&gt;&lt;/td&gt;</b><b>        &lt;td&gt;&lt;%: item.Artist.Name %&gt;&lt;/td&gt;</b><b>        &lt;td&gt;&lt;%: item.Genre.Name %&gt;&lt;/td&gt;</b><b>    &lt;/tr&gt;</b><b>&lt;% } %&gt;</b><b>&lt;/table&gt;</b></pre></td></tr></table></span></div><br /></li>
          <li>Change the following descriptions.<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>HTML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;asp:Content ID="Content1" ContentPlaceHolderID="TitleContent" runat="server"&gt;<b>    Store Manager - All Albums</b>&lt;/asp:Content&gt;&lt;asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server"&gt;<b>    &lt;h2&gt;Albums&lt;/h2&gt;</b></pre></td></tr></table></span></div><br /></li>
          <li>Also update the link to create a new Album changing its text.<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>HTML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;asp:Content ID="Content1" ContentPlaceHolderID="TitleContent" runat="server"&gt;    Store Manager - All Albums&lt;/asp:Content&gt;&lt;asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server"&gt;    &lt;h2&gt;Albums&lt;/h2&gt;    &lt;p&gt;        &lt;%: Html.ActionLink("Create New Album", "Create") %&gt;    &lt;/p&gt;</pre></td></tr></table></span></div><br /></li>
        </ol>
        <a name="_Toc269320718" href="#">
          <span />
        </a>
        <a name="_Toc269481315" href="#">
          <span />
        </a>
        <a name="_Toc269992847" href="#">
          <span />
        </a>
        <a name="_Toc282517409" href="#">
          <span />
        </a>
        <p>
          <b>Task 5 – Running the Application</b>
        </p>
        <p>In this task, you will test that the <b>StoreManager</b><b>Index</b> View template displays a list of albums according to the design of the previous steps.</p>
        <ol>
          <li>Press <b>F5</b> to run the Application.</li>
          <li>The project starts in the Home page. Change the URL to <b>/StoreManager</b> to verify that a list of albums is displayed, showing their <b>Title</b>, <b>Artist</b> and <b>Genre</b>.<p><img src="images\d7c278d7-c984-4489-b073-ac0b462d0430.png" /></p><p><b>Figure 5</b><br /><i>Browsing the list of Albums</i></p><br /></li>
        </ol>
        <h1 class="heading">Next Step</h1>
        <p>
          <a href="docSet_fb55f39f-097c-4261-a4ea-69649905255e.html">Exercise 2: Adding an HTML Helper</a>
        </p>
        <br />
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to VSKitFdbk@Microsoft.com<p />Copyright © 2011 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>