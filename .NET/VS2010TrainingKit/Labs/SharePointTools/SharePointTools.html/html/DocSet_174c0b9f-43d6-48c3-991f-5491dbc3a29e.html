<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 5: Creating a Visual Web Part with AJAX Behavior" />
      <MSHelp:RLTitle Title="Exercise 5: Creating a Visual Web Part with AJAX Behavior" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 5: Creating a Visual Web Part with AJAX Behavior</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">Microsoft SharePoint 2010 Developer Tools</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 5: Creating a Visual Web Part with AJAX Behavior</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>In this exercise, you will add a second Web Part using the Visual Web Part template. This template, allows you to create the UI for a Web Part using an ASP.NET User Control and the Visual Studio User Control Designer. You will also use the UpdatePanel control from ASP.NET AJAX to give your Web Part a Web 2.0 user experience eliminating postbacks.</p>
        <a name="_Toc281415918" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Adding a Visual Web Part</b>
        </p>
        <p>In this task, you will use the Visual Web Part template to create a new SharePoint Project Item in the project.</p>
        <ol>
          <li>Open Microsoft Visual Studio 2010 from <b>Start | All Programs | Microsoft Visual Studio 2010 | Microsoft Visual Studio 2010</b>.</li>
          <li>Open the solution file <b>ContosoWebParts.sln</b> located under the <b>Source\Ex5-AjaxVisualWebPart\begin\ </b>(choosing the folder that matches the language of your preference.) Alternatively, you may continue working with the solution obtained after completing the previous exercise.</li>
          <li>Add a new Web Part to the <b>ContosoWebParts</b> project named <b>ListInspector</b>. To do this:<ol><li>Right-click on the <b>ContosoWebParts</b> project in Solution Explorer, point to <b>Add</b> and select <b>New Item</b>.</li><li>Select the Visual Web Part project item template, give it a name of <b>ListInspector</b> and click <b>Add</b>.<p><img src="images\efa19541-3bea-4da3-b68e-7d39cbf5f982.png" /></p><p><b>Figure 40</b><br /><i>Adding a new Visual Web Part (C#)</i></p><br /><p><img src="images\995858b0-e707-4474-9b61-995e765cddcb.png" /></p><p><b>Figure 41</b><br /><i>Adding a new Visual Web Part (VB)</i></p><br /></li></ol></li>
          <li>Inspect the SharePoint Project Item node for the Web Part named ListInspector. Verify that it contains the SharePoint Project Item files named <b>Elements.xml</b>, <b>ListInspector.cs</b> / <b>ListInspector.vb</b>, <b>ListInspector.webpart</b>, <b>ListInspectorUserControl.ascx</b> and <b>ListInspectorUserControl.ascx.cs</b> / <b>ListInspectorUserControl.ascx.vb</b>.<p><img src="images\750374f9-f647-446b-a3f2-f363e6febb64.png" /></p><p><b>Figure 42</b><br /><i>Visual Web Part node structure (C#)</i></p><br /><p><img src="images\79b87ee7-f054-4135-bea6-59c1e98a18e1.png" /></p><p><b>Figure 43</b><br /><i>Visual Web Part node structure (VB)</i></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> The structure of the Visual Web Part is similar to the Web Part. Additionally, it includes a user control (<b>ListInspectorUserContro.ascx</b>) which allows the developer to create a rich UI.</td></tr></table><p /></div><br /></li>
          <li>Open the Web Part Description file, named <b>ListInspector.webPart,</b> and examine the XML content inside. You should see the XML already contains two property elements for the Title property and the Description property.</li>
          <li>Replace the <b>&lt;data&gt;</b> element of the Web Part Description with the following content.<p><i>(Code Snippet – SharePoint Tools Lab – ListInspector Description)</i></p><div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;webParts&gt;  &lt;webPart xmlns="http://schemas.microsoft.com/WebPart/v3"&gt;    &lt;metaData&gt;      &lt;type name="ContosoWebParts.ListInspector.ListInspector, $SharePoint.Project.AssemblyFullName$" /&gt;      &lt;importErrorMessage&gt;$Resources:core,ImportErrorMessage;&lt;/importErrorMessage&gt;    &lt;/metaData&gt;<b>    &lt;data&gt;</b><b>      &lt;properties&gt;</b><b>        &lt;property name="Title" type="string"&gt;ListInspector&lt;/property&gt;</b><b>        &lt;property name="Description" type="string"&gt;Web Part which shows all the lists in the current site and allows you to get several of its property values&lt;/property&gt;</b><b>        &lt;property name="ChromeType" type="chrometype"&gt;TitleAndBorder&lt;/property&gt;</b><b>        &lt;property name="CatalogIconImageUrl" type="string"&gt;_layouts/images/ContosoWebParts/WebPartIcon.gif&lt;/property&gt;</b><b>        &lt;property name="TitleIconImageUrl" type="string"&gt;_layouts/images/ContosoWebParts/WebPartIcon.gif&lt;/property&gt;</b><b>      &lt;/properties&gt;</b><b>    &lt;/data&gt;</b>  &lt;/webPart&gt;&lt;/webParts&gt;</pre></td></tr></table></span></div><br /></li>
          <li>Open the <b>Elements.xml</b> and modify the URL attribute of File element to ensure that it is unique. To do this, add "<b>ContosoWebPart_</b>" to the beginning of the URL property value.</li>
          <li>Change the value for the Group property to "<b>Contoso Web Parts</b>". Elements.xml should look as follows:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;Elements xmlns="http://schemas.microsoft.com/sharepoint/" &gt;  &lt;Module Name="ListInspector" List="113" Url="_catalogs/wp"&gt;<b>    &lt;File Path="ListInspector\ListInspector.webpart" Url="ContosoWebParts_ListInspector.webpart" Type="GhostableInLibrary" &gt;</b><b>      &lt;Property Name="Group" Value="Contoso Web Parts" /&gt;</b><b>    &lt;/File&gt;</b>  &lt;/Module&gt;&lt;/Elements&gt;</pre></td></tr></table></span></div><br /></li>
        </ol>
        <a name="_Toc281415919" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Adding Markup to the Web Part</b>
        </p>
        <p>In this task you will add the markup necessary to create the elements of the WebPart.</p>
        <ol>
          <li>Add reference to <b>System.Web.Extensions</b>. To do this:<ol><li>In the Solution Explorer, right-click on the <b>ContosoWebParts </b>project, and choose Add Reference.</li><li>In the <b>.NET</b> tab, search for the <b>System.Web.Extensions</b> component and click <b>OK</b><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> This reference is required because developing the new Visual Web Part will involve the UpdatePanel control from ASP.NET AJAX.</td></tr></table><p /></div><br /></li></ol></li>
          <li>In the Solution Explorer, right-click on the <b>ListInspectorUserControl.ascx </b>file and choose View Designer to open the User Control in Design mode.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> The designer should be empty at first as no controls or HTML text has been added.</td></tr></table><p /></div><br /></li>
          <li>From the <b>AJAX Extensions</b> section of the Toolbox, drag and drop the <b>UpdatePanel</b> control onto the user control designer.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> You can enable the Toolbox from the <b>View\Toolbox</b> menu </td></tr></table><p /></div><br /><p><img src="images\b1a8c484-62e2-49b4-a119-1eb6413d637a.png" /></p><p><b>Figure 44</b><br /><i>Ajax Extensions Toolbox</i></p><br /></li>
          <li>In the Bottom Left of the Designer, select <b>Source</b>, to switch the User Control back to code view.<p><img src="images\864c6245-3fdf-487f-9755-d8073e53e52a.png" /></p><p><b>Figure 45</b><br /><i>Switching to Source View</i></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> Note that the User Control designer now contains a reference to the <b>System.Web.Extensions</b>. This is because you added the <b>UpdatePanel</b> control.</td></tr></table><p /></div><br /><div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>ASP.NET</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>...Inherits="ContosoWebParts.ListInspector.ListInspectorUserControl" %&gt;<b>&lt;asp:UpdatePanel ID="UpdatePanel1" runat="server"&gt;</b><b>&lt;/asp:UpdatePanel&gt;</b></pre></td></tr></table></span></div><br /></li>
          <li>Inside the <b>UpdatePanel</b> element, add a <b>ContentTemplate</b> as shown in the following code block.<p><i>(Code Snippet – SharePoint Tools Lab – ListInspector WebPart ContentTemplate)</i></p><div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>ASP.NET</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;asp:UpdatePanel ID="UpdatePanel1" runat="server"&gt;<b>    &lt;ContentTemplate&gt;</b><b>        &lt;table style="width: 100%; border-style: solid; border-color: #CCCCCC; border-width: 1px;"&gt;</b><b>      &lt;tr&gt;</b><b>        &lt;td style="width: 180px; vertical-align: top;"&gt;</b><b>          &lt;asp:ListBox ID="lstLists" runat="server" Width="100%" Rows="10" AutoPostBack="true"</b><b>            OnSelectedIndexChanged="lslLists_SelectedIndexChanged"&gt;&lt;/asp:ListBox&gt;</b><b>        &lt;/td&gt;</b><b>        &lt;td style="width: auto; vertical-align: top;"&gt;</b><b>          &lt;table style="width: 100%;"&gt;</b><b>            &lt;tr&gt;</b><b>              &lt;td style="width: 132px;"&gt;</b><b>                Title</b><b>              &lt;/td&gt;</b><b>              &lt;td style="width: auto;"&gt;</b><b>                &lt;asp:Label ID="lblListTitle" runat="server"&gt;&lt;/asp:Label&gt;</b><b>              &lt;/td&gt;</b><b>            &lt;/tr&gt;</b><b>            &lt;tr&gt;</b><b>              &lt;td&gt;</b><b>                ID:</b><b>              &lt;/td&gt;</b><b>              &lt;td&gt;</b><b>                &lt;asp:Label ID="lblListID" runat="server"&gt;&lt;/asp:Label&gt;</b><b>              &lt;/td&gt;</b><b>            &lt;/tr&gt;</b><b>            &lt;tr&gt;</b><b>              &lt;td&gt;</b><b>                Document Library:</b><b>              &lt;/td&gt;</b><b>              &lt;td&gt;</b><b>                &lt;asp:Label ID="lblListIsDocumentLibrary" runat="server"&gt;&lt;/asp:Label&gt;</b><b>              &lt;/td&gt;</b><b>            &lt;/tr&gt;</b><b>            &lt;tr&gt;</b><b>              &lt;td&gt;</b><b>                Hidden:</b><b>              &lt;/td&gt;</b><b>              &lt;td&gt;</b><b>                &lt;asp:Label ID="lblListIsHidden" runat="server"&gt;&lt;/asp:Label&gt;</b><b>              &lt;/td&gt;</b><b>            &lt;/tr&gt;</b><b>            &lt;tr&gt;</b><b>              &lt;td&gt;</b><b>                Item Count:</b><b>              &lt;/td&gt;</b><b>              &lt;td style="margin-left: 40px"&gt;</b><b>                &lt;asp:Label ID="lblListItemCount" runat="server"&gt;&lt;/asp:Label&gt;</b><b>              &lt;/td&gt;</b><b>            &lt;/tr&gt;</b><b>            &lt;tr&gt;</b><b>              &lt;td&gt;</b><b>                URL:</b><b>              &lt;/td&gt;</b><b>              &lt;td style="margin-left: 40px"&gt;</b><b>                &lt;asp:HyperLink ID="lnkListUrl" runat="server" Target="_blank" /&gt;</b><b>              &lt;/td&gt;</b><b>            &lt;/tr&gt;</b><b>          &lt;/table&gt;</b><b>        &lt;/td&gt;</b><b>      &lt;/tr&gt;</b><b>    &lt;/table&gt;</b><b>    &lt;/ContentTemplate&gt;</b>&lt;/asp:UpdatePanel&gt;</pre></td></tr></table></span></div><br /></li>
          <li>Switch the User Control back into Design view and verify that you can see the table layout.<p><img src="images\cf0a9fe3-9079-422a-9106-44e82c6a2e57.png" /></p><p><b>Figure 46</b><br /><i>ListInspector Visual Web Part table layout</i></p><br /></li>
        </ol>
        <a name="_Toc281415920" href="#">
          <span />
        </a>
        <p>
          <b>Task 3 – Implementing the Web Part</b>
        </p>
        <p>In this task, you will add the code needed to implement the web part’s functionality. </p>
        <ol>
          <li>In the Solution Explorer, right-click on <b>ListInspectorUserControl.ascx </b>and<b> </b>choose View Code (<b>F7</b>) to open its code behind.</li>
          <li>Add a the following namespace directive:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using Microsoft.SharePoint;</b></pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports Microsoft.SharePoint</b></pre></td></tr></table></span></div><br /></li>
          <li>Replace the default class definition with the following:<p><i>(Code Snippet - SharePoint Tools Lab – ListInspectorUserControl Class Definition CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>public partial class ListInspectorUserControl : UserControl</b><b>{</b><b>    protected Guid selectedListId = Guid.Empty;</b><b>    protected bool updateListProperties = false;</b><b>}</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet – SharePoint Tools Lab – ListInspectorUserControl Class Definition VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Partial Public Class ListInspectorUserControl</b><b>    Inherits UserControl</b><b>    Protected selectedListId As Guid = Guid.Empty</b><b>    Protected updateListProperties As Boolean = False</b><b>End Class</b></pre></td></tr></table></span></div><br /></li>
          <li>Add a method named <b>lslLists_SelectedIndexChanged</b> to the ListInspectorUserControl class.<p><i>(Code Snippet – SharePoint Tools Lab – SelectedIndexChanged Method CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>protected void lslLists_SelectedIndexChanged(object sender, EventArgs e)</b><b>{</b><b>    selectedListId = new Guid(lstLists.SelectedValue);</b><b>    updateListProperties = true;</b><b>}</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet – SharePoint Tools Lab – SelectedIndexChanged Method VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Protected Sub lslLists_SelectedIndexChanged(ByVal sender As Object, ByVal e As EventArgs) Handles lstLists.SelectedIndexChanged</b><b>    selectedListId = New Guid(lstLists.SelectedValue)</b><b>    updateListProperties = True</b><b>End Sub</b></pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> The ListInspector<b> </b>Web Part will not work until you add this method implementation. This is because the pre-provided table layout text you pasted, contains a listbox named <b>lstLists</b> containing an attribute which attaches it to an event handler named <b>lslLists_SelectedIndexChanged</b>.</td></tr></table><p /></div><br /></li>
          <li>Add an overridden implementation of the <b>OnPreRender</b> method <p><i>(Code Snippet – SharePoint Tools Lab – OnPreRender Method CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>protected override void OnPreRender(EventArgs e)</b><b>{</b><b>    if ((lstLists.SelectedIndex &gt; -1) &amp;&amp; (!updateListProperties))</b><b>    {</b><b>        selectedListId = new Guid(lstLists.SelectedValue);</b><b>    }</b><b>    lstLists.Items.Clear();</b><b>    SPWeb site = SPContext.Current.Web;</b><b>    foreach (SPList list in site.Lists)</b><b>    {</b><b>        ListItem listItem = new ListItem(list.Title, list.ID.ToString());</b><b>        lstLists.Items.Add(listItem);</b><b>    }</b><b>    if (selectedListId != Guid.Empty)</b><b>    {</b><b>        lstLists.Items.FindByValue(selectedListId.ToString()).Selected = true;</b><b>    }</b><b>    if (updateListProperties)</b><b>    {</b><b>        SPList list = SPContext.Current.Web.Lists[selectedListId];</b><b>        lblListTitle.Text = list.Title;</b><b>        lblListID.Text = list.ID.ToString().ToUpper();</b><b>        lblListIsDocumentLibrary.Text = (list is SPDocumentLibrary).ToString();</b><b>        lblListIsHidden.Text = list.Hidden.ToString();</b><b>        lblListItemCount.Text = list.ItemCount.ToString();</b><b>        lnkListUrl.Text = list.DefaultViewUrl;</b><b>        lnkListUrl.NavigateUrl = list.DefaultViewUrl;</b><b>    }</b><b>}</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet – SharePoint Tools Lab – OnPreRender Method VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Protected Overrides Sub OnPreRender(ByVal e As System.EventArgs)</b><b>    If (lstLists.SelectedIndex &gt; -1) AndAlso Not updateListProperties Then</b><b>        selectedListId = New Guid(lstLists.SelectedValue)</b><b>    End If</b><b>    lstLists.Items.Clear()</b><b>    Dim site = SPContext.Current.Web</b><b>    For Each list As SPList In site.Lists</b><b>        Dim listItem = New ListItem(list.Title, list.ID.ToString())</b><b>        lstLists.Items.Add(listItem)</b><b>    Next</b><b>    If Not selectedListId = Guid.Empty Then</b><b>        lstLists.Items.FindByValue(selectedListId.ToString()).Selected = True</b><b>    End If</b><b>    If updateListProperties Then</b><b>        Dim list = SPContext.Current.Web.Lists(selectedListId)</b><b>        lblListTitle.Text = list.Title</b><b>        lblListID.Text = list.ID.ToString().ToUpper()</b><b>        lblListIsDocumentLibrary.Text = (TypeOf list Is SPDocumentLibrary).ToString()</b><b>        lblListIsHidden.Text = list.Hidden.ToString()</b><b>        lblListItemCount.Text = list.ItemCount.ToString()</b><b>        lnkListUrl.Text = list.DefaultViewUrl</b><b>        lnkListUrl.NavigateUrl = list.DefaultViewUrl</b><b>    End If</b><b>End Sub</b></pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> The code above clears the items from the <b>lstLists</b> control and then add a new list item for each <b>SPList</b> item in the current site. When adding ListItem instances to the ListBox control, it uses the list title as the ListItem Text and the list's identifying GUID as the ListItem Value.<br />If the <b>UpdateListProperties</b> field contains a value of true, then it will update all the Label controls on the right-hand side of the table layout to display properties of the selected list.</td></tr></table><p /></div><br /></li>
          <li>Press <b>CTRL+SHIFT+B</b> to build the solution.</li>
        </ol>
        <a name="_Toc281415921" href="#">
          <span />
        </a>
        <p>
          <b>Exercise 5: Verification</b>
        </p>
        <ol>
          <li>Run the <b>Deploy</b> command which will retract the previously deployed solution and will deploy the updated solution package.</li>
          <li>Open Internet Explorer, and browse to <b>http://localhost/sites/SharePointToolsLab</b>. Follow these steps to go through the activation process.<ol><li>Point to <b>Site Actions</b> and select <b>Site Settings</b> to navigate to the Site Settings page.</li><li>Inside the <b>Site Collection Administration</b> section of the Site Settings page, click on the <b>Site collection features</b> link to navigate to the Site Collection Administration &gt; Features page.</li><li>Locate the <b>Contoso Web Parts</b> and <b>activate</b> it.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> If it was already active, then deactivate first and then activate it. The key point here is that feature activation is what provisions the .webpart file into the Web Part Gallery which will allow you to test your work.</td></tr></table><p /></div><br /></li></ol></li>
          <li>Add a test instance of the Web Part you have just created to a Web Part Page. To do this:<ol><li>Navigate to the home page<b> http://localhost/sites/SharePointToolsLab</b>. The ribbon at the top of the page should have a tab titled <b>Page</b>.</li><li>Click on the <b>Page</b> tab and then select the command from the <b>Edit Page</b> button that takes you into the mode for adding, modifying and deleting Web Parts from the page.<p><img src="images\98dd7a31-bcc3-4bf9-a393-b7a02771bda8.png" /></p><p><b>Figure 47</b><br /><i>The Edit Page button</i></p><br /></li><li>Click on the <b>Add a Web Part</b> link or make sure the Left Web Part zone is selected (indicated by a different blue color in the left zone) and use the contextual <b>Page Tools</b> ribbon tab.</li><li>Click on the <b>Insert</b> tab on the ribbon and click on the <b>Web Part</b> button.<p><img src="images\532359c2-9b1b-4ec3-b286-64d1820c5925.png" /></p><p><b>Figure 48</b><br /><i>Insert a new Web Part</i></p><br /></li><li>Select the <b>Contoso Web Parts</b> category in the left-hand section. In the right-hand section, click on your web part, named <b>ListInspector</b>.</li><li>Make sure the dropdown list with the <b>Add Web Part to</b> name, has the <b>Left</b> value, and click the <b>Add</b> button to add the Web Part instance to the page.<p><img src="images\dabc09c7-5faf-4f46-b305-2408f5619eeb.png" /></p><p><b>Figure 49</b><br /><i>Select a new Web Part to add</i></p><br /></li></ol></li>
          <li>At this point, you have gone through all the required steps to create, deploy and test a Web Part. The test instance of your Web Part should look like the following screenshot.<p><img src="images\443736c8-1b16-44e1-871c-e29767b9c352.png" /></p><p><b>Figure 50</b><br /><i>Web Part inserted in Home page</i></p><br /></li>
        </ol>
        <h1 class="heading">Next Step</h1>
        <p>
          <a href="docSet_e22984c3-4a20-49d9-8aa9-3dbfdab83ff8.html">Summary</a>
        </p>
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to VSKitFdbk@Microsoft.com<p />Copyright © 2011 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>