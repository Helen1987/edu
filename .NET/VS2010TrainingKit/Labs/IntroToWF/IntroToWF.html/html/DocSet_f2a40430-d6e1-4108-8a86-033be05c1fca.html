<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 3: The CodeActivity" />
      <MSHelp:RLTitle Title="Exercise 3: The CodeActivity" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 3: The CodeActivity</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">Introduction to Workflow 4</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 3: The CodeActivity</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>As you have seen so far, WF4 consists of a <b><i>designer</i></b> that edits <b>.xaml</b> files and a <b><i>runtime</i></b>that<b><i> </i></b>invokes activities. When you author a workflow, you are creating a new kind of activity and because activities are just classes that inherit from <b>System.Activities.Activity</b> or one of its subclasses, you can declare workflows using C#, VB or XAML. In this exercise, you will implement your “greeting” business process by creating an activity in C# or VB.</p>
        <p>As previously said, activities implement a business process. Some activities will implement the process by invoking other activities. For example, your <b>SayHello</b> activity did not actually write text to the console but instead used the <b>WriteLine</b> activity to do the work.  could have implemented the same <b>SayHello</b> activity in C# or VB by inheriting from <b>System.Activities.Activity</b> and creating an <b>Implementation</b> as you see in the following examples</p>
        <div class="code">
          <span codeLanguage="CSharp">
            <table width="100%" cellspacing="0" cellpadding="0">
              <tr>
                <th>C#</th>
                <th>
                  <span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0">
                    <img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span>
                </th>
              </tr>
              <tr>
                <td colspan="2">
                  <pre>public sealed class SayHelloActivity : Activity{    WriteLine writeLine = new WriteLine() { Text = "Hello Workflow 4" };     public SayHelloActivity()    {        Implementation = () =&gt; { return writeLine; };    }}</pre>
                </td>
              </tr>
            </table>
          </span>
        </div>
        <br />
        <div class="code">
          <span codeLanguage="VisualBasicUsage">
            <table width="100%" cellspacing="0" cellpadding="0">
              <tr>
                <th>Visual Basic</th>
                <th>
                  <span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0">
                    <img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span>
                </th>
              </tr>
              <tr>
                <td colspan="2">
                  <pre>Public NotInheritable Class SayHelloActivity    Inherits Activity    Private writeLine As New WriteLine With {.Text = "Hello Workflow 4"}    Public Sub New()        Implementation = Function()                             Return writeLine                         End Function    End SubEnd Class</pre>
                </td>
              </tr>
            </table>
          </span>
        </div>
        <br />
        <p>This approach is useful if you are creating a workflow out of other activities that do the work as did in exercise 1 with the <b>WriteLine</b> activity. However, there may be times when you want to create an activity that implements the business logic in itself or by calling another class that is not an activity to do the work. To do this, you will inherit from a different base class <b>System.Activities.CodeActivity</b> and override the <b>Execute</b> method.</p>
        <a name="_Toc244412391" href="#">
          <span />
        </a>
        <a name="_Toc281935100" href="#">
          <span />
        </a>
        <p>
          <b>Task 0 – Opening the Solution</b>
        </p>
        <p>To begin this exercise you can use the solution you finished from Exercise 2. Alternatively, you can follow the following steps to begin with Exercise 3.</p>
        <ol>
          <li>Start <b>Microsoft Visual Studio 2010</b> from <b>Start | All Programs | Microsoft Visual Studio 2010</b>.</li>
          <li>Open the starting solution for Exercise 3 located under the <b>Source\Ex3-CodeActivity\Begin</b> folder and use it as the starting point for this exercise.</li>
          <li>Press <b>CTRL+SHIFT+B</b> to build the solution.</li>
        </ol>
        <a name="_Toc243285439" href="#">
          <span />
        </a>
        <a name="_Toc243388955" href="#">
          <span />
        </a>
        <a name="_Toc244412392" href="#">
          <span />
        </a>
        <a name="_Toc281935101" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Creating the SayHelloInCode Activity</b>
        </p>
        <p>In this task, you will create an activity in code and write the text to the console using <b>Console.WriteLine</b></p>
        <ol>
          <li>Right-click the <b>HelloWorkflow </b>project, select <b>Add / New Item.</b>   From the <b>Workflow</b> templates select <b>Code Activity</b> and name the file <b>SayHelloInCode</b>.</li>
          <li>Delete the <b>Text</b> property from the template – you will not need it.</li>
          <li><b>CodeActivity</b> is an <i>abstract</i> class. That means that when you inherit from it, you must override the <b>Execute</b> method. This is the place where you will do the work of your activity. Replace the default implementation of the class with the following code.<p><i>(Code Snippet - Introduction to WF</i>4<i>Lab - SayHelloInCode Class CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>public sealed class SayHelloInCode : CodeActivity</b><b>{</b><b>    protected override void Execute(CodeActivityContext context)</b><b>    {</b><b>        Console.WriteLine("Hello Workflow 4 in code");</b><b>    }</b><b>}</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet - Introduction to WF</i>4<i>Lab - SayHelloInCode Class VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Public NotInheritable Class SayHelloInCode</b><b>    Inherits CodeActivity</b><b></b><b>    Protected Overrides Sub Execute(ByVal context As CodeActivityContext)</b><b>        Console.WriteLine("Hello Workflow 4 in code")</b><b>    End Sub</b><b>End Class</b></pre></td></tr></table></span></div></li>
          <br />
        </ol>
        <a name="_Toc243285440" href="#">
          <span />
        </a>
        <a name="_Toc243388956" href="#">
          <span />
        </a>
        <a name="_Toc244412393" href="#">
          <span />
        </a>
        <a name="_Toc281935102" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Updating Main to Invoke SayHelloInCode</b>
        </p>
        <ol>
          <li>Change <b>Program.cs </b>(<b>C#</b>) or <b>Module1.vb</b> (<b>Visual Basic</b>) to use the new <b>SayHelloInCode</b> class. To do this, locate the <b>WorkflowInvoker.Invoke </b>method<b> </b>code, and replace it with the following code:<p>(Code Snippet - Introduction to WF4 Lab - <i>InvokeSayHelloInCode Class CSharp</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>static void Main(string[] args){<b>WorkflowInvoker.Invoke(new SayHelloInCode());</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet - Introduction to WF4 Lab - <i>InvokeSayHelloInCode Class VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Shared Sub Main(ByVal args() As String)<b>    WorkflowInvoker.Invoke(New SayHelloInCode()) </b>End Sub</pre></td></tr></table></span></div></li>
          <br />
        </ol>
        <h1 class="heading">Next Step</h1>
        <p>
          <a href="docSet_add7eda6-6c35-4ede-97cd-e8ac7a5c63e1.html">Exercise 3: Verification</a>
        </p>
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to VSKitFdbk@Microsoft.com<p />Copyright © 2011 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>