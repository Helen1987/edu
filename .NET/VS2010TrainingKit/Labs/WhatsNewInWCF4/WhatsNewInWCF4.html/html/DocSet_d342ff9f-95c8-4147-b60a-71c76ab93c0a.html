<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 10: Backup Lists" />
      <MSHelp:RLTitle Title="Exercise 10: Backup Lists" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 10: Backup Lists</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">What's New in WCF 4?</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 10: Backup Lists</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>You have seen how routing can be used to bridge protocols and route based on content. In this exercise, you will see how you can add list of alternate services to be used in the event that the primary service cannot be contacted.</p>
        <p>
          <img src="images\92d6649d-7505-4d26-9f68-03b2344d8d0a.png" />
        </p>
        <p>
          <b>Figure 35</b>
          <br />
          <i>The Routing Service using a backup list</i>
        </p>
        <br />
        <a name="_Toc249317774" href="#">
          <span />
        </a>
        <a name="_Toc280957347" href="#">
          <span />
        </a>
        <p>
          <b>Task 0 – Opening the Solution</b>
        </p>
        <p>To begin this exercise you can use the solution you finished from Exercise 9. Alternatively, you can follow the following steps to begin with Exercise 10.</p>
        <ol>
          <li>Open the starting solution for Exercise 10 located under the <b>Source\Ex10-BackupLists\Begin</b><b>(choosing the folder that matches the language of your preference.)</b> Use it as the starting point for this exercise.</li>
          <li>Press <b>CTRL+SHIFT+B</b> to build the solution.</li>
        </ol>
        <a name="_Toc249317775" href="#">
          <span />
        </a>
        <a name="_Toc280957348" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Adding a Bad Endpoint</b>
        </p>
        <p>In this task, you will modify the configuration to call an endpoint that does not exist. This will allow us to see how the router service behaves when it cannot contact an endpoint.</p>
        <ol>
          <li>Open the <b>Web.config</b> file from the <b>RouterService</b> project.</li>
          <li>Add the <b>badEndpoint</b> definition to the <b>client</b> section as shown.<p><i>(Code Snippet - What is new in WCF4 Lab – badEndpoint XML)</i></p><div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Web.config</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;client&gt;<b>  &lt;endpoint name="badEndpoint"</b><b>            address="http://localhost:404/bad/endpoint"</b><b>            binding="wsHttpBinding"</b><b>            contract="*" /&gt;</b></pre></td></tr></table></span></div><br /></li>
          <li>Now, in order to get a communication failure, you must actually direct the Routing Service to send to this endpoint. Replace one of the good calculator endpoints in the filter table. In the filter table definition, change the entry that references the <i>roundingCalculatorEndpoint</i> to instead reference <b>badEndpoint</b><div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;filterTables&gt;  &lt;filterTable name="filterTable1"&gt;    &lt;add filterName="XPathFilter"         endpointName="badEndpoint"         priority="1"/&gt;</pre></td></tr></table></span></div><br /></li>
        </ol>
        <a name="_Toc249317776" href="#">
          <span />
        </a>
        <a name="_Toc280957349" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Observing the Routing Fail</b>
        </p>
        <ol>
          <li>Right-click the <b>Ex10-BackupLists</b> solution and select <b>Set StartUp Projects</b>.</li>
          <li>Select <b>Multiple startup projects</b> and set all the projects to <b>Start</b>.</li>
          <li>Press <b>F5</b> to debug the solution.</li>
          <li>In the CalculatorClient select <b>Routed HTTP connection</b> and click on the <b>Use Rounding</b> button to add the rounding message header.</li>
          <li>Click on <b>Invoke Service</b>.</li>
          <li>The client will receive a communication exception because the router tried to route the message to an endpoint that does not exist.<p><img src="images\12fa7cd8-4c91-4c52-844f-68ee336d9cc7.png" /></p><p><b>Figure 36</b><br /><i>The client receives a communication error</i></p><br /></li>
        </ol>
        <a name="_Toc249317777" href="#">
          <span />
        </a>
        <a name="_Toc280957350" href="#">
          <span />
        </a>
        <p>
          <b>Task 3 – Enabling Backup Lists</b>
        </p>
        <p>The router service can establish a backup list for each endpoint that it routes to. In the event that it is unable to communicate to the primary endpoint, it will begin trying the services in the backup list until it successfully invokes a service or all of them fail.</p>
        <ol>
          <li>Open the <b>Web.config</b> file from the <b>RouterService</b> project.</li>
          <li>Add a backup list in the <b>routing</b> section as shown.<p><i>(Code Snippet - What is new in WCF4 Lab – BackupLists XML)</i></p><div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Web.config</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;routing&gt;<b>  &lt;backupLists&gt;</b><b>    &lt;backupList name="backupList1"&gt;</b><b>      &lt;add endpointName="roundingCalculatorEndpoint"/&gt;</b><b>    &lt;/backupList&gt;</b><b>  &lt;/backupLists&gt;</b></pre></td></tr></table></span></div><br /></li>
          <li>Filters can have an optional backup list. Modify the XPathFilter that is routing to the <b>badEndpoint</b> and add a backup list as shown.<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>XML</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;filterTable name="filterTable1"&gt;  &lt;add filterName="XPathFilter"       endpointName="badEndpoint"<b>       backupList="backupList1"</b>       priority="1"/&gt;</pre></td></tr></table></span></div><br /></li>
        </ol>
        <h1 class="heading">Next Step</h1>
        <p>
          <a href="docSet_697ec331-2460-4539-8f5d-89664a02ddd7.html">Exercise 10: Verification</a>
        </p>
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to VSKitFdbk@Microsoft.com<p />Copyright © 2011 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>