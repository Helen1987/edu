<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 1: Building Your First Windows Azure Application" />
      <MSHelp:RLTitle Title="Exercise 1: Building Your First Windows Azure Application" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 1: Building Your First Windows Azure Application</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">Introduction to Windows Azure</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 1: Building Your First Windows Azure Application</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>In this exercise, you create a guest book application and execute it in the local development fabric. For this purpose, you will use the Windows Azure Tools for Microsoft Visual Studio to create the project using the Cloud Service project template. These tools extend Visual Studio to enable the creation, building and running of Windows Azure services. You will continue to work with this project throughout the remainder of the lab.</p>
        <div class="alert">
          <table width="100%" cellspacing="0" cellpadding="0">
            <tr>
              <th align="left">
                <img class="note" src="../local/note.gif" />Note:</th>
            </tr>
            <tr>
              <td>  To reduce typing, you can right-click where you want to insert source code, select Insert Snippet, select My Code Snippets and then select the entry matching the current exercise step.</td>
            </tr>
          </table>
          <p />
        </div>
        <br />
        <a name="_Toc194406453" href="#">
          <span />
        </a>
        <a name="_Toc189563214" href="#">
          <span />
        </a>
        <a name="_Toc182141331" href="#">
          <span />
        </a>
        <a name="_Toc238899093" href="#">
          <span />
        </a>
        <a name="_Toc266620934" href="#">
          <span />
        </a>
        <a name="_Toc278816302" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Creating the Visual Studio Project</b>
        </p>
        <p>In this task, you create a new Cloud Service project in Visual Studio.</p>
        <ol>
          <li>Open Visual Studio<b> </b>as administrator from<b> Start | All Programs | Microsoft Visual Studio 2010 </b>by right clicking the <b>Microsoft Visual Studio 2010 </b>shortcut and choosing <b>Run as administrator</b>. </li>
          <li>If the <b>User Account Control</b> dialog appears, click <b>Continue</b>.</li>
          <li>From the <b>File</b> menu, choose <b>New</b> and then <b>Project</b>. </li>
          <li>In the <b>New Project</b> dialog, expand the language of your preference (Visual C# or Visual Basic) in the <b>Installed Templates</b> list and select <b>Cloud</b>. Choose the <b>Windows Azure Project</b> template, set the <b>Name</b> of the project to <b>GuestBook</b>, set the location to <b>Ex1-BuildingYourFirstWindowsAzureApp\[CS|VB] </b>in the <b>Source</b> folder of the lab, change the solution name to <b>Begin</b>, and ensure that <b>Create directory for solution</b> is checked. Click <b>OK</b> to create the project.<p><img src="images\93dd4cc1-4666-413b-9f95-dee5ae75d794.png" /></p><p><b>Figure 1</b><br /><i>Creating a new Windows Azure Cloud Service project (C#)</i></p><br /><p><img src="images\a969413e-c50e-45b0-84a5-9457908558a3.png" /></p><p><b>Figure 2</b><br /><i>Creating a new Windows Azure Cloud Service project (Visual Basic)</i></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td><b> </b>Windows Azure supports the .NET Framework 4.0. If you use Visual Studio 2010 to create the project, you can select this version for the target framework and take advantage of its new features.</td></tr></table><p /></div><br /></li>
          <li>In the <b>New Windows Azure Project</b> dialog, inside the <b>Roles</b> panel, expand the tab for the language of your choice (Visual C# or Visual Basic), select <b>ASP.NET Web Role </b>from the list of available roles and click the arrow (&gt;) to add an instance of this role to the solution. Before closing the dialog, select the new role in the right panel, click the pencil icon and rename the role as <b>GuestBook_WebRole</b>. Click <b>OK</b> to create the cloud service solution.<p><img src="images\a3b7aba6-8fc9-4953-999c-bb9b4a34ad03.png" /></p><p><b>Figure 3</b><br /><i>Assigning roles to the cloud service project (C#)</i></p><br /><p><img src="images\f41a668b-6565-431a-8ab2-7af0a2d5ba77.png" /></p><p><b>Figure 4</b><br /><i>Assigning roles to the cloud service project (Visual Basic)</i></p><br /></li>
          <li>In <b>Solution Explorer</b>, review the structure of the created solution.<p><img src="images\828e04b0-3844-49d0-9fee-25583462c1ae.png" /></p><p><b>Figure 5</b><br /><i>Solution Explorer showing the GuestBook application (C#)</i></p><br /><p><img src="images\ea523c6e-8b27-4236-b02d-a4f12e6d30b2.png" /></p><p><b>Figure 6</b><br /><i>Solution Explorer showing the GuestBook application (Visual Basic)</i></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> The generated solution contains two separate projects. The first project, named <b>GuestBook</b>, holds the configuration for the web and worker roles that compose the cloud application. It includes the service definition file, <b>ServiceDefinition.csdef</b>, which contains metadata needed by the Windows Azure fabric to understand the requirements of your application, such as which roles are used, their trust level, the endpoints exposed by each role, the local storage requirements and the certificates used by the roles. The service definition also establishes configuration settings specific to the application. The service configuration file, <b>ServiceConfiguration.cscfg</b>, specifies the number of instances to run for each role and sets the value of configuration settings defined in the service definition file. This separation between service definition and configuration allows you to update the settings of a running application by uploading a new service configuration file.<br />The <b>Roles</b> node in the cloud service project enables you to configure what roles the service includes (web, worker or both) as well as which projects to associate with these roles. Adding and configuring roles through the Roles node will update the <b>ServiceDefinition.csdef</b> and <b>ServiceConfiguration.cscfg</b> files.<br />The second project, named <b>GuestBook_WebRole</b>, is a standard ASP.NET Web Application project template modified for the Windows Azure environment. It contains an additional class that provides the entry point for the web role and contains methods to manage the initialization, starting, and stopping of the role.</td></tr></table><p /></div></li>
        </ol>
        <br />
        <a name="_Toc266620935" href="#">
          <span />
        </a>
        <a name="_Toc278816303" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Creating a Data Model for Entities in Table Storage</b>
        </p>
        <p>The application stores guest book entries in Windows Azure Table storage. The Table service offers semi-structured storage in the form of tables that contain collections of entities. Entities have a primary key and a set of properties, where a property is a name, typed-value pair. </p>
        <p>In addition to the properties required by your model, every entity in Table Storage has two key properties: the <b>PartitionKey</b> and the <b>RowKey</b>. These properties together form the table's primary key and uniquely identify each entity in the table. Entities also have a <b>Timestamp</b> system property, which allows the service to keep track of when an entity was last modified. This field is intended for system use and should not be accessed by the application. The Table Storage client API provides a <b>TableServiceEntity</b> class that defines the necessary properties. Although you can use the <b>TableServiceEntity</b> class as the base class for your entities, this is not required.</p>
        <p>The Table service API is compliant with the REST API provided by <a href="http://msdn.microsoft.com/en-us/library/cc668792.aspx">WCF Data Services</a> (formerly ADO.NET Data Services Framework) allowing you to use the <a href="http://msdn.microsoft.com/en-us/library/cc668772.aspx">WCF Data Services Client Library</a> (formerly .NET Client Library) to work with data in Table Storage using .NET objects.</p>
        <p>The Table service does not enforce any schema for tables making it possible for two entities in the same table to have different sets of properties. Nevertheless, the GuestBook application uses a fixed schema to store its data.  </p>
        <p>In order to use the WCF Data Services Client Library to access data in table storage, you need to create a context class that derives from <b>TableServiceContext</b>, which itself derives from <b>DataServiceContext</b> in WCF Data Services. The Table Storage API allows applications to create the tables that they use from these context classes. For this to happen, the context class must expose each required table as a property of type <b>IQueryable&lt;<i>SchemaClass</i>&gt;</b>, where <b><i>SchemaClass</i></b> is the class that models the entities stored in the table.  </p>
        <p>In this task, you model the schema of the entities stored by the GuestBook application and create a context class to use WCF Data Services to access the information in table storage.  To complete the task, you create an object that can be data bound to data controls in ASP.NET and implements the basic data access operations: read, update, and delete.</p>
        <ol>
          <li>Create a new project for the schema classes. To create the project, in the<b> File </b>menu, point to <b>Add</b> and then select <b>New Project</b>. </li>
          <li>In the <b>Add New Project</b> dialog, expand the language of your choice under the <b>Installed Templates</b> tree view, select the <b>Windows</b> category, and then choose the <b>Class Library</b> project template. Set the name to <b>GuestBook_Data</b>, leave the proposed location inside the solution folder unchanged, and then click <b>OK</b>.<p><img src="images\31e7050c-10f6-458d-8a8d-81d6c91f96fd.png" /></p><p><b>Figure 7</b><br /><i>Creating a class library for GuestBook entities (C#)</i></p><br /><p><img src="images\e4b287f5-3a5b-4cdf-9b19-a008f23c728c.png" /></p><p><b>Figure 8</b><br /><i>Creating a class library for GuestBook entities (Visual Basic)</i></p><br /></li>
          <li>Delete the default class file generated by the class library template. To do this, right-click <b>Class1.cs </b>(for Visual C# Projects) or <b>Class1.vb</b> (for Visual Basic Projects) and choose <b>Delete</b>. Click <b>OK</b> in the confirmation dialog.</li>
          <li>Add a reference to the .NET Client Library for WCF Data Services in the <b>GuestBook_Data</b> project. In <b>Solution Explorer, </b>right-click the <b>GuestBook_Data</b> project node, select <b>Add Reference</b>, click the <b>.NET</b> tab, select the <b>System.Data.Services.Client</b> component and click <b>OK</b>.<p><img src="images\9fb8ca2d-1113-4fad-a280-acefc1a57620.png" /></p><p><b>Figure 9</b><br /><i>Adding a reference to the System.Data.Service.Client component</i></p><br /></li>
          <li>Repeat the previous step to add a reference to the Windows Azure storage client API assembly, this time choosing the <b>Microsoft.WindowsAzure.StorageClient</b> component instead.</li>
          <li>Before you can store an entity in a table, you must first define its schema. To do this, right-click <b>GuestBook_Data</b> in <b>Solution Explorer</b>, point to <b>Add</b> and select <b>Class</b>. In the <b>Add New Item</b> dialog, set the name to <b>GuestBookEntry.cs </b>(for Visual C# projects) or <b>GuestBookEntry.vb</b> (for Visual Basic projects) and click <b>Add</b>.<p><img src="images\e991590e-d860-4e5c-a208-6a96fe73fd20.png" /></p><p><b>Figure 10</b><br /><i>Adding the GuestBookEntry class (C#)</i></p><br /><p><img src="images\352b191c-8198-4da4-82d3-0350ec388c4f.png" /></p><p><b>Figure 11</b><br /><i>Adding the GuestBookEntry class (Visual Basic)</i></p><br /></li>
          <li>At the top of the file, insert the following namespace declaration to import the types contained in the <b>Microsoft.WindowsAzure.StorageClient</b> namespace.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using Microsoft.WindowsAzure.StorageClient;</b></pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports Microsoft.WindowsAzure.StorageClient</b></pre></td></tr></table></span></div><br /></li>
          <li>If not already opened, open the <b>GuestBookEntry.cs</b> file (for Visual C# projects) or <b>GuestBookEntry.vb</b> file (for Visual Basic projects) and then update the declaration of the <b>GuestBookEntry</b> class to make it public and derive from the <b>TableServiceEntity</b> class.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>In Visual Basic, the template for a new class already declares the class as Public.</td></tr></table><p /></div><br /><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>public class GuestBookEntry</b><b>    : Microsoft.WindowsAzure.StorageClient.TableServiceEntity</b>{}</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Public Class GuestBookEntry</b><b>    Inherits Microsoft.WindowsAzure.StorageClient.TableServiceEntity</b>End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td><b>TableServiceEntity</b> is a class found in the Storage Client API. This class defines the <b>PartititionKey</b>, <b>RowKey</b> and <b>TimeStamp</b> system properties required by every entity stored in a Windows Azure table.<br />Together, the <b>PartitionKey</b> and <b>RowKey</b> define the <b>DataServiceKey</b> that uniquely identifies every entity within a table.</td></tr></table><p /></div><br /></li>
          <li>Add a default constructor to the <b>GuestBookEntry</b> class that initializes its <b>PartitionKey</b> and <b>RowKey</b> properties.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookEntry constructor – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>public GuestBookEntry()</b><b>{            </b><b>  PartitionKey = DateTime.UtcNow.ToString("MMddyyyy");</b><b>  // Row key allows sorting, so we make sure the rows come back in time order.</b><b>  RowKey = string.Format("{0:10}_{1}", DateTime.MaxValue.Ticks - DateTime.Now.Ticks, Guid.NewGuid());</b><b>}</b></pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookEntry constructor – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Public Sub New()</b><b>  PartitionKey = DateTime.UtcNow.ToString("MMddyyyy")</b><b>  ' Row key allows sorting, so we make sure the rows come back in time order.</b><b>  RowKey = String.Format("{0:10}_{1}", DateTime.MaxValue.Ticks - DateTime.Now.Ticks, Guid.NewGuid())</b><b>End Sub</b></pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>To partition the data, the GuestBook application uses the date of the entry as the <b>PartitionKey</b>, which means that there will be a separate partition for each day of guest book entries. In general, you choose the value of the partition key to ensure load balancing of the data across storage nodes. <br />The <b>RowKey</b> is a reverse DateTime field with a GUID appended for uniqueness. Tables within partitions are sorted in RowKey order, so this will sort the tables into the correct order to be shown on the home page, with the newest entry shown at the top.</td></tr></table><p /></div><br /></li>
          <li>To complete the definition of the the <b>GuestBookEntry</b> class, add properties for <b>Message</b>, <b>GuestName</b>, <b>PhotoUrl</b>, and <b>ThumbnailUrl</b> to hold information about the entry.<p> (Code Snippet – <i>Introduction to Windows Azure - Ex1 Table Schema Properties – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>public string Message { get; set; }</b><b>public string GuestName { get; set; }</b><b>public string PhotoUrl { get; set; }</b><b>public string ThumbnailUrl { get; set; }</b></pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Table Schema Properties – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Public Property Message As String</b><b>Public Property GuestName As String</b><b>Public Property PhotoUrl As String</b><b>Public Property ThumbnailUrl As String</b></pre></td></tr></table></span></div><br /></li>
          <li>Save the <b>GuestBookEntry.cs </b>file (for Visual C# projects) or<b> GuestBookEntry.vb</b> file (for Visual Basic projects).</li>
          <li>Next, you need to create the context class required to access the <i>GuestBook</i> table using WCF Data Services. To do this, in <b>Solution Explorer</b>, right-click the <b>GuestBook_Data</b> project, point to <b>Add</b> and select <b>Class</b>. In the <b>Add New Item</b> dialog, set the <b>Name</b> to <b>GuestBookDataContext.cs </b>(for Visual C# projects) or <b>GuestBookDataContext.vb</b> (for Visual Basic projects) and click <b>Add</b>.</li>
          <li>In the new class file, update the declaration of the new class to make it public and inherit the <b>TableServiceContext</b> class.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>In Visual Basic, the template for a new class already declares the class as Public.</td></tr></table><p /></div><br /><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>public class GuestBookDataContext </b><b>  : Microsoft.WindowsAzure.StorageClient.TableServiceContext</b>{}</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Public Class GuestBookDataContext</b><b>  Inherits Microsoft.WindowsAzure.StorageClient.TableServiceContext</b>End Class</pre></td></tr></table></span></div><br /></li>
          <li>Now, add a default constructor to initialize the base class with storage account information.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataContext Class – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataContext   : Microsoft.WindowsAzure.StorageClient.TableServiceContext{<b>  public GuestBookDataContext(string baseAddress, Microsoft.WindowsAzure.StorageCredentials credentials)</b><b>      : base(baseAddress, credentials)</b><b>  { }</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataContext Class – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataContext  Inherits Microsoft.WindowsAzure.StorageClient.TableServiceContext<b>  Public Sub New(ByVal baseAddress As String, ByVal credentials As Microsoft.WindowsAzure.StorageCredentials)</b><b>    MyBase.New(baseAddress, credentials)</b><b>  End Sub</b>End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>You can find the <b>TableServiceContext</b> class in the storage client API. This class derives from <b>DataServiceContext</b> in WCF Data Services and manages the credentials required to access your storage account as well as providing support for a retry policy for its operations.</td></tr></table><p /></div><br /></li>
          <li>Add a property to the <b>GuestBookDataContext</b> class to expose the <b>GuestBookEntry</b> table. To do this, insert the following (highlighted) code into the class. <p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookEntry Property – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataContext   : Microsoft.WindowsAzure.StorageClient.TableServiceContext{  ...<b>  public IQueryable&lt;GuestBookEntry&gt; GuestBookEntry</b><b>  {</b><b>    get</b><b>    {</b><b>      return this.CreateQuery&lt;GuestBookEntry&gt;("GuestBookEntry");</b><b>    }</b><b>  }</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookEntry Property – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataContext  Inherits Microsoft.WindowsAzure.StorageClient.TableServiceContext  ...<b>  Public ReadOnly Property GuestBookEntry() As IQueryable(Of GuestBookEntry)</b><b>    Get</b><b>      Return Me.CreateQuery(Of GuestBookEntry)("GuestBookEntry")</b><b>    End Get</b><b>  End Property</b>End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>You can use the <b>CreateTablesFromModel</b> method in the <b>CloudTableClient</b> class to create the tables needed by the application. When you supply a <b>DataServiceContext</b> (or <b>TableServiceContext</b>) derived class to this method, it locates any properties that return an <b>IQueryable&lt;<i>T</i>&gt;</b>, where the generic parameter <b><i>T</i></b> identifies the class that models the table schema, and creates a table in storage named after the property.</td></tr></table><p /></div><br /></li>
          <li>Finally, you need to implement an object that can be bound to data controls in ASP.NET.  In <b>Solution Explorer</b>, right-click <b>GuestBook_Data</b>, point to <b>Add</b>, and select <b>Class</b>. In the <b>Add New Item</b> dialog, set the name to <b>GuestBookDataSource.cs </b>(for Visual C# projects) or <b>GuestBookDataSource.vb </b>(for Visual Basic projects) and click <b>Add</b>.</li>
          <li>In the new class file, add the following namespace declarations to import the types contained in the <b>Microsoft.WindowsAzure</b> and <b>Microsoft.WindowsAzure.StorageClient</b> namespaces.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using Microsoft.WindowsAzure;</b><b>using Microsoft.WindowsAzure.StorageClient;</b></pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports Microsoft.WindowsAzure</b><b>Imports Microsoft.WindowsAzure.StorageClient</b></pre></td></tr></table></span></div><br /></li>
          <li>In the <b>GuestBookDataSource</b> class, make the class <b>public</b> and define member fields for the data context and the storage account information, as shown below.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>In Visual Basic, the template for a new class already declares the class as Public.</td></tr></table><p /></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Fields – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataSource{<b>  private static CloudStorageAccount storageAccount;</b><b>  private GuestBookDataContext context;</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Fields – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataSource<b>  Private Shared storageAccount As CloudStorageAccount</b><b>  Private context As GuestBookDataContext</b>End Class</pre></td></tr></table></span></div><br /></li>
          <li>Now, add a static (Shared in Visual Basic) constructor to the data source class as shown in the following (highlighted) code. This code creates the tables from the <b>GuestBookDataContext</b> class.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Static Constructor – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataSource{  ...<b>  static GuestBookDataSource()</b><b>  {</b><b>    storageAccount = CloudStorageAccount.FromConfigurationSetting("DataConnectionString");</b><b>    CloudTableClient.CreateTablesFromModel(</b><b>        typeof(GuestBookDataContext),</b><b>        storageAccount.TableEndpoint.AbsoluteUri,</b><b>        storageAccount.Credentials);</b><b>  }</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Shared Constructor – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataSource  ...<b>  Shared Sub New()</b><b>    storageAccount = CloudStorageAccount.FromConfigurationSetting("DataConnectionString")</b><b>    CloudTableClient.CreateTablesFromModel(GetType(GuestBookDataContext), storageAccount.TableEndpoint.AbsoluteUri, storageAccount.Credentials)</b><b>  End Sub</b>End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>  The static (Shared in Visual Basic) constructor initializes the storage account by reading its settings from the configuration and then uses the <b>CreateTablesFromModel</b> method in the <b>CloudTableClient</b> class to create the tables used by the application from the model defined by the <b>GuestBookDataContext</b> class. By using the static constructor, you ensure that this initialization task is executed only once.</td></tr></table><p /></div><br /></li>
          <li>Add a default constructor to the <b>GuestBookDataSource</b> class to initialize the data context class used to access table storage.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Constructor – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataSource{  ...<b>  public GuestBookDataSource()</b><b>  {</b><b>    this.context = new GuestBookDataContext(storageAccount.TableEndpoint.AbsoluteUri, storageAccount.Credentials);</b><b>    this.context.RetryPolicy = RetryPolicies.Retry(3, TimeSpan.FromSeconds(1));</b><b>  }</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Constructor – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataSource  ...<b>  Public Sub New()</b><b>    Me.context = New GuestBookDataContext(storageAccount.TableEndpoint.AbsoluteUri, storageAccount.Credentials)</b><b>    Me.context.RetryPolicy = RetryPolicies.Retry(3, TimeSpan.FromSeconds(1))</b><b>  End Sub</b>End Class</pre></td></tr></table></span></div><br /></li>
          <li>Next, insert the following method to return the contents of the <i>GuestBookEntry</i> table. <p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Select – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataSource{  ...<b>  public IEnumerable&lt;GuestBookEntry&gt; GetGuestBookEntries()</b><b>  {</b><b>    var results = from g in this.context.GuestBookEntry</b><b>                  where g.PartitionKey == DateTime.UtcNow.ToString("MMddyyyy")</b><b>                  select g;</b><b>    return results;</b><b>  }</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource Select – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataSource  ...<b>  Public Function GetGuestBookEntries() As IEnumerable(Of GuestBookEntry)</b><b>    Dim results = From g In Me.context.GuestBookEntry _</b><b>                  Where g.PartitionKey = DateTime.UtcNow.ToString("MMddyyyy") _</b><b>                  Select g</b><b>    Return results</b><b>  End Function</b>End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>The <b>GetGuestBookEntries</b> method retrieves today's guest book entries by constructing a LINQ statement that filters the retrieved information using the current date as the partition key value. The web role uses this method to bind to a data grid and display the guest book. </td></tr></table><p /></div><br /></li>
          <li>Now, add the following method to insert new entries into the <i>GuestBookEntry</i> table.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource AddGuestBookEntry – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataSource{  ...<b>  public void AddGuestBookEntry(GuestBookEntry newItem)</b><b>  {</b><b>    this.context.AddObject("GuestBookEntry", newItem);</b><b>    this.context.SaveChanges();</b><b>  }</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource AddGuestBookEntry – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataSource  ...<b>  Public Sub AddGuestBookEntry(ByVal newItem As GuestBookEntry)</b><b>    Me.context.AddObject("GuestBookEntry", newItem)</b><b>    Me.context.SaveChanges()</b><b>  End Sub</b>End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>This method adds a new <b>GuestBookEntry</b> object to the data context and then calls <b>SaveChanges</b> to write the entity to storage.</td></tr></table><p /></div><br /></li>
          <li>Finally, add a method to the data source class to update the thumbnail URL property for an entry.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource UpdateImageThumbnail – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public class GuestBookDataSource{  ...<b>  public void UpdateImageThumbnail(string partitionKey, string rowKey, string thumbUrl)</b><b>  {</b><b>    var results = from g in this.context.GuestBookEntry</b><b>                  where g.PartitionKey == partitionKey &amp;&amp; g.RowKey == rowKey</b><b>                  select g;</b><b>    var entry = results.FirstOrDefault&lt;GuestBookEntry&gt;();</b><b>    entry.ThumbnailUrl = thumbUrl;</b><b>    this.context.UpdateObject(entry);</b><b>    this.context.SaveChanges();</b><b>  }</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 GuestBookDataSource UpdateImageThumbnail – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class GuestBookDataSource  ...<b>  Public Sub UpdateImageThumbnail(ByVal partitionKey As String, ByVal rowKey As String, ByVal thumbUrl As String)</b><b>    Dim results = From g In Me.context.GuestBookEntry _</b><b>                  Where g.PartitionKey = partitionKey AndAlso g.RowKey = rowKey _</b><b>                  Select g</b><b>    Dim entry = results.FirstOrDefault()</b><b>    entry.ThumbnailUrl = thumbUrl</b><b>    Me.context.UpdateObject(entry)</b><b>    Me.context.SaveChanges()</b><b>  End Sub</b>End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>The <b>UpdateImageThumbnail</b> method locates an entry using its partition key and row key; it updates the thumbnail URL, notifies the data context of the update, and then saves the changes.</td></tr></table><p /></div><br /></li>
          <li>Save the <b>GuestBookDataSource.cs</b> file (for Visual C# projects) or <b>GuestBookDataSource.vb</b> file (for Visual Basic projects).</li>
        </ol>
        <br />
        <a name="_Toc266620936" href="#">
          <span />
        </a>
        <a name="_Toc278816304" href="#">
          <span />
        </a>
        <p>
          <b>Task 3 – Creating a Web Role to Display the Guest Book and Process User Input</b>
        </p>
        <p>In this task, you update the web role project that you generated in Task 1, when you created the Windows Azure Cloud Service solution. This involves updating the UI to render the list of guest book entries. For this purpose, you will find a page that has the necessary elements in the <b>Assets</b> folder of this exercise, which you will add to the project.  Next, you implement the code necessary to store submitted entries in table storage and images in blob storage. To complete this task, you configure the storage account used by the Web role.</p>
        <ol>
          <li>Add a reference in the web role to the <b>GuestBook_Data</b> project. In <b>Solution Explorer</b>, right-click the <b>GuestBook_WebRole</b> project node and select <b>Add Reference</b>, switch to the <b>Projects</b> tab, select the <b>GuestBook_Data</b> project, and then click then <b>OK</b>.</li>
          <li>The web role template generates a default page. You will replace it with another page that contains the UI of the guest book application. To delete the page, in <b>Solution Explorer</b>, right-click <b>Default.aspx</b> in the <b>GuestBook_WebRole</b> project and select <b>Delete</b>.</li>
          <li>Add the main page and its associated assets to the web role. To do this, right-click <b>GuestBook_WebRole</b> in <b>Solution Explorer</b>, point to <b>Add</b> and select <b>Existing Item</b>. In the <b>Add Existing Item</b> dialog, browse to the <b>Assets</b> folder in the <b>Source\Ex1-BuildingYourFirstWindowsAzureApp</b> for the language of your project (Visual C# or Visual Basic), hold the <b>CTRL</b> key down while you select every file in this folder and click <b>Add</b>.<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>The <b>Assets</b> folder contains five files that you need to add to the project, a Default.aspx file with its code-behind and designer files, a CSS file, and an image file.</td></tr></table><p /></div><br /></li>
          <li>Open the code-behind file for the main page in the <b>GuestBook_WebRole</b> project. To do this, right-click the <b>Default.aspx</b> file in <b>Solution Explorer</b> and select <b>View Code</b>.</li>
          <li>In the code-behind file, insert the following namespace declarations.<p>(Code Snippet<i>– Introduction to Windows Azure - Ex1 Web Role Namespace Declarations – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using System.IO;</b><b>using System.Net;</b><b>using Microsoft.WindowsAzure;</b><b>using Microsoft.WindowsAzure.ServiceRuntime;</b><b>using Microsoft.WindowsAzure.StorageClient;</b><b>using GuestBook_Data;</b></pre></td></tr></table></span></div><br /><p>(Code Snippet<i>– Introduction to Windows Azure - Ex1 Web Role Namespace Declarations – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports System.IO</b><b>Imports System.Net</b><b>Imports Microsoft.WindowsAzure</b><b>Imports Microsoft.WindowsAzure.ServiceRuntime</b><b>Imports Microsoft.WindowsAzure.StorageClient</b><b>Imports GuestBook_Data</b></pre></td></tr></table></span></div><br /></li>
          <li>Declare the following member fields in the <b>Default</b> class.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Web Role Member Fields – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public partial class Default : System.Web.UI.Page{<b>  private static bool storageInitialized = false;</b><b>  private static object gate = new Object();</b><b>  private static CloudBlobClient blobStorage;</b>  ...}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Web Role Member Fields – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Partial Public Class _Default  Inherits System.Web.UI.Page<b>  Private Shared storageInitialized As Boolean = False</b><b>  Private Shared gate As New Object()</b><b>  Private Shared blobStorage As CloudBlobClient</b>  ...End Class</pre></td></tr></table></span></div><br /></li>
          <li>Locate the <b>SignButton_Click</b> event handler in the code-behind file and insert the following code.<p>(Code Snippet<i>– Introduction to Windows Azure - Ex1 SignButton_Click – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public partial class Default : System.Web.UI.Page{  ...  protected void SignButton_Click(object sender, EventArgs e)  {<b>    if (FileUpload1.HasFile)</b><b>    {</b><b>      InitializeStorage();</b><b>      // upload the image to blob storage</b><b>      string uniqueBlobName = string.Format("guestbookpics/image_{0}{1}", Guid.NewGuid().ToString(), Path.GetExtension(FileUpload1.FileName));</b><b>      CloudBlockBlob blob = blobStorage.GetBlockBlobReference(uniqueBlobName);</b><b>      blob.Properties.ContentType = FileUpload1.PostedFile.ContentType;</b><b>      blob.UploadFromStream(FileUpload1.FileContent);</b><b>      System.Diagnostics.Trace.TraceInformation("Uploaded image '{0}' to blob storage as '{1}'", FileUpload1.FileName, uniqueBlobName);</b><b>      // create a new entry in table storage</b><b>      GuestBookEntry entry = new GuestBookEntry() { GuestName = NameTextBox.Text, Message = MessageTextBox.Text, PhotoUrl = blob.Uri.ToString(), ThumbnailUrl = blob.Uri.ToString() };</b><b>      GuestBookDataSource ds = new GuestBookDataSource();</b><b>      ds.AddGuestBookEntry(entry);</b><b>      System.Diagnostics.Trace.TraceInformation("Added entry {0}-{1} in table storage for guest '{2}'", entry.PartitionKey, entry.RowKey, entry.GuestName);</b><b>    }</b><b>    NameTextBox.Text = "";</b><b>    MessageTextBox.Text = "";</b><b>    DataList1.DataBind();</b>  }}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 SignButton_Click – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class _Default  Inherits System.Web.UI.Page  ...  Protected Sub SignButton_Click(ByVal sender As Object, ByVal e As EventArgs) Handles SignButton.Click<b>    If FileUpload1.HasFile Then</b><b>      InitializeStorage()</b><b>      ' upload the image to blob storage</b><b>      Dim uniqueBlobName As String = String.Format("guestbookpics/image_{0}{1}", Guid.NewGuid().ToString(), Path.GetExtension(FileUpload1.FileName))</b><b>      Dim blob As CloudBlockBlob = blobStorage.GetBlockBlobReference(uniqueBlobName)</b><b>      blob.Properties.ContentType = FileUpload1.PostedFile.ContentType</b><b>      blob.UploadFromStream(FileUpload1.FileContent)</b><b>      System.Diagnostics.Trace.TraceInformation("Uploaded image '{0}' to blob storage as '{1}'", FileUpload1.FileName, uniqueBlobName)</b><b>      ' create a new entry in table storage</b><b>      Dim entry As New GuestBookEntry() With {.GuestName = NameTextBox.Text, .Message = MessageTextBox.Text, .PhotoUrl = blob.Uri.ToString(), .ThumbnailUrl = blob.Uri.ToString()}</b><b>      Dim ds As New GuestBookDataSource()</b><b>      ds.AddGuestBookEntry(entry)</b><b>      System.Diagnostics.Trace.TraceInformation("Added entry {0}-{1} in table storage for guest '{2}'", entry.PartitionKey, entry.RowKey, entry.GuestName)</b><b>    End If</b><b>    NameTextBox.Text = ""</b><b>    MessageTextBox.Text = ""</b><b>    DataList1.DataBind()</b>  End SubEnd Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>To process a new guest book entry after the user submits the page, the handler first calls the <b>InitializeStorage</b> method to ensure that the blob container used to store images exists and allows public access.  You will implement this method shortly. <br />It then obtains a reference to the blob container, generates a unique name and creates a new blob, and then uploads the image submitted by the user into this blob. Notice that the method initializes the <b>ContentType</b> property of the blob from the content type of the file submitted by the user. When the guest book page reads the blob back from storage, the response returns this content type, allowing a page to display the image contained in the blob simply by referring to its URL.<br />After that, it creates a new <b>GuestBookEntry</b> entity, which is the entity you defined in the previous task, initializes it with the information submitted by the user, and then uses the <b>GuestBookDataSource</b> class to save the entry to table storage using the .NET Client Library for WCF Data Services.<br />Finally, it data binds the guest book entries list to refresh its contents.</td></tr></table><p /></div><br /></li>
          <li>Update the body of the <b>Timer1_Tick</b> method with the code shown below. <p>(Code Snippet<i>– Introduction to Windows Azure - Ex1 Timer1_Tick – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public partial class Default : System.Web.UI.Page{  ...  protected void Timer1_Tick(object sender, EventArgs e)  {<b>    DataList1.DataBind();</b>  }}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Timer1_Tick – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class _Default  Inherits System.Web.UI.Page  ...  Protected Sub Timer1_Tick(ByVal sender As Object, ByVal e As EventArgs) Handles Timer1.Tick<b>    DataList1.DataBind()</b>  End SubEnd Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>The timer periodically forces the page to refresh the contents of the guest book entries list.</td></tr></table><p /></div><br /></li>
          <li>Locate the <b>Page_Load</b> event handler and update its body with the following code to enable the page refresh timer.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Page_Load – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public partial class Default : System.Web.UI.Page{  ...  protected void Page_Load(object sender, EventArgs e)  {<b>    if (!Page.IsPostBack)</b><b>    {</b><b>      Timer1.Enabled = true;</b><b>    }</b>  }}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Page_Load – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class _Default  Inherits System.Web.UI.Page  ...  Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load<b>    If Not (Page.IsPostBack) Then</b><b>      Timer1.Enabled = True</b><b>    End If</b>  End SubEnd Class</pre></td></tr></table></span></div><br /></li>
          <li>Implement the <b>InitializeStorage</b> method by replacing its body with the following (highlighted) code.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 InitializeStorage – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public partial class Default : System.Web.UI.Page{  ...  private void InitializeStorage()  {<b>    if (storageInitialized)</b><b>    {</b><b>      return;</b><b>    }</b><b>    lock (gate)</b><b>    {</b><b>      if (storageInitialized)</b><b>      {</b><b>        return;</b><b>      }</b><b>      try</b><b>      {</b><b>        // read account configuration settings</b><b>        var storageAccount = CloudStorageAccount.FromConfigurationSetting("DataConnectionString");</b><b>        // create blob container for images</b><b>        blobStorage = storageAccount.CreateCloudBlobClient();</b><b>        CloudBlobContainer container = blobStorage.GetContainerReference("guestbookpics");</b><b>        container.CreateIfNotExist();</b><b>        // configure container for public access</b><b>        var permissions = container.GetPermissions();</b><b>        permissions.PublicAccess = BlobContainerPublicAccessType.Container;</b><b>        container.SetPermissions(permissions);</b><b>      }</b><b>      catch (WebException)</b><b>      {</b><b>        throw new WebException("Storage services initialization failure. "</b><b>            + "Check your storage account configuration settings. If running locally, "</b><b>            + "ensure that the Development Storage service is running.");</b><b>      }</b><b>      storageInitialized = true;</b><b>    }</b>  }}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 InitializeStorage – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class _Default  Inherits System.Web.UI.Page  ...  Private Sub InitializeStorage()<b>    If storageInitialized Then</b><b>      Return</b><b>    End If</b><b>    SyncLock gate</b><b>      If storageInitialized Then</b><b>        Return</b><b>      End If</b><b>      Try</b><b>        ' read account configuration settings</b><b>        Dim storageAccount = CloudStorageAccount.FromConfigurationSetting("DataConnectionString")</b><b>        ' create blob container for images</b><b>        blobStorage = storageAccount.CreateCloudBlobClient()</b><b>        Dim container As CloudBlobContainer = blobStorage.GetContainerReference("guestbookpics")</b><b>        container.CreateIfNotExist()</b><b>        ' configure container for public access</b><b>        Dim permissions = container.GetPermissions()</b><b>        permissions.PublicAccess = BlobContainerPublicAccessType.Container</b><b>        container.SetPermissions(permissions)</b><b>      Catch e1 As WebException</b><b>        Throw New WebException("Storage services initialization failure. " _</b><b>          &amp; "Check your storage account configuration settings. If running locally, " _</b><b>          &amp; "ensure that the Development Storage service is running.")</b><b>      End Try</b><b>      storageInitialized = True</b><b>    End SyncLock</b>  End SubEnd Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> The <b>InitializeStorage</b> method first ensures that it executes only once. It reads the storage account settings from the Web role configuration, creates a blob container for the images uploaded with each guest book entry and configures it for public access.</td></tr></table><p /></div><br /></li>
          <li>Because the web role uses Windows Azure storage services, you need to provide your storage account settings. To create a new setting, in <b>Solution Explorer</b>, expand the <b>Roles</b> node in the <b>GuestBook</b> project, double-click <b>GuestBook_WebRole</b> to open the properties for this role and select the <b>Settings</b> tab. Click <b>Add Setting</b>, type “<i>DataConnectionString</i>” in the <b>Name</b> column, change the <b>Type</b> to <i>ConnectionString</i>, and then click the button labeled  with an ellipsis. <p><img src="images\4e45919b-d3db-4546-becc-03e496dcc037.png" /></p><p><b>Figure 12</b><br /><i>Configuring the storage account settings</i></p><br /></li>
          <li>In the <b>Storage Account Connection String</b> dialog, choose the option labeled <b>Use the Windows Azure storage emulator </b>and then click <b>OK</b>. <p><img src="images\3cb479dd-9589-46fb-a9f7-907cd95f5d25.png" /></p><p><b>Figure 13</b><br /><i>Creating a connection string for the storage emulator</i></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>A storage account is a unique endpoint for the Windows Azure Blob, Queue, and Table services. You must create a storage account in the Management Portal to use these services. In this exercise, you use Windows Azure storage emulator, which is included in the Windows Azure SDK development environment to simulate the Blob, Queue, and Table services available in the cloud. If you are building a hosted service that employs storage services or writing any external application that calls storage services, you can test locally against the Windows Azure storage emulator.<br />To use the storage emulator, you set the value of the <b>UseDevelopmentStorage</b> keyword in the connection string for the storage account to <i>true</i>. When you deploy your application to Windows Azure, you need to update the connection string to specify storage account settings including your account name and shared key. For example,<br />&lt;Setting name="DataConnectionString" value="DefaultEndpointsProtocol=https;AccountName=YourAccountName;AccountKey=YourAccountKey" /&gt;<br />where <i>YourAccountName</i> is the name of your Azure Storage account and <i>YourAccountKey</i> is your access key.</td></tr></table><p /></div><br /></li>
          <li>Press <b>CTRL + S</b> to save changes to the role configuration.</li>
          <li>Finally, you need to set up the environment for the configuration publisher. In the <b>GuestBook_WebRole</b> project, open the <b>Global.asax.cs</b> file (for Visual C# projects) or the <b>Global.asax.vb</b> file (for Visual Basic projects).</li>
          <li>At the top of the file, insert the following namespace declaration to import the types contained in the <b>Microsoft.WindowsAzure </b>and <b>Microsoft.WindowsAzure.ServiceRuntime</b> namespaces.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>using Microsoft.WindowsAzure;using Microsoft.WindowsAzure.ServiceRuntime;</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Imports Microsoft.WindowsAzureImports Microsoft.WindowsAzure.ServiceRuntime</pre></td></tr></table></span></div><br /></li>
          <li>Insert the following code into the <b>Application_Start</b> method replacing the default comment.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 SetConfigurationSettingPublisher – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>void Application_Start(object sender, EventArgs e){<b>Microsoft.WindowsAzure.CloudStorageAccount.SetConfigurationSettingPublisher((configName, configSetter) =&gt;</b><b>    {</b><b>      configSetter(RoleEnvironment.GetConfigurationSettingValue(configName));</b><b>    });</b>}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 SetConfigurationSettingPublisher – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Sub Application_Start(ByVal sender As Object, ByVal e As EventArgs)<b>CloudStorageAccount.SetConfigurationSettingPublisher(Function(configName, configSetter) configSetter(RoleEnvironment.GetConfigurationSettingValue(configName)))</b>End Sub</pre></td></tr></table></span></div></li>
        </ol>
        <br />
        <a name="_Toc266620937" href="#">
          <span />
        </a>
        <a name="_Toc278816305" href="#">
          <span />
        </a>
        <p>
          <b>Task 4 – Queuing Work Items for Background Processing</b>
        </p>
        <p>In preparation for the next exercise, you now update the front-end web role to dispatch work items to an Azure queue for background processing. These work items will remain in the queue until you add a worker role that picks items from the queue and generates thumbnails for each uploaded image.</p>
        <ol>
          <li>Open the code-behind file for the main page of the web role project. To do this, right-click the <b>Default.aspx</b> file in <b>Solution Explorer</b> and select <b>View Code</b>.</li>
          <li>Declare a queue client member by inserting the following (highlighted) declaration into the <b>Default</b> class.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 CloudQueueClient member – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public partial class _Default : System.Web.UI.Page{  private static bool storageInitialized = false;  private static object gate = new Object();  private static CloudBlobClient blobStorage;<b>  private static CloudQueueClient queueStorage;</b>  ...}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 CloudQueueClient member – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Class _Default  Inherits System.Web.UI.Page  Private Shared storageInitialized As Boolean = False  Private Shared gate As New Object()  Private Shared blobStorage As CloudBlobClient<b>  Private Shared queueStorage As CloudQueueClient</b>  ...End Class</pre></td></tr></table></span></div><br /></li>
          <li>Now, update the storage initialization code to create the queue, if it does not exist, and then initialize the queue reference created in the previous step. To do this, locate the <b>InitializeStorage</b> method and insert the following (highlighted) code into this method immediately after the code that configures the blob container for public access.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Create Queue – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public partial class Default : System.Web.UI.Page{  ...  private void InitializeStorage()  {    ...      try      {        ...        // configure container for public access        var permissions = container.GetPermissions();        permissions.PublicAccess = BlobContainerPublicAccessType.Container;        container.SetPermissions(permissions);<b>        // create queue to communicate with worker role</b><b>        queueStorage = storageAccount.CreateCloudQueueClient();</b><b>        CloudQueue queue = queueStorage.GetQueueReference("guestthumbs");</b><b>        queue.CreateIfNotExist();</b>      }      catch (WebException)      {        ...}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Create Queue – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Partial Public Class _Default  Inherits System.Web.UI.Page  ...  Private Sub InitializeStorage()      ...      Try        ...        ' configure container for public access        Dim permissions = container.GetPermissions()        permissions.PublicAccess = BlobContainerPublicAccessType.Container        container.SetPermissions(permissions)<b>        ' create queue to communicate with worker role</b><b>        queueStorage = storageAccount.CreateCloudQueueClient()</b><b>        Dim queue As CloudQueue = queueStorage.GetQueueReference("guestthumbs")</b><b>        queue.CreateIfNotExist()</b>      Catch e1 As WebException      ...End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>The updated code creates a queue that the web role uses to submit new jobs to the worker role.</td></tr></table><p /></div><br /></li>
          <li>Finally, add code to post a work item to the queue. To do this, locate the <b>SignButton_Click</b> event handler and insert the following (highlighted) code immediately after the lines that create a new entry in table storage.<p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Queueing work items – CS</i>)</p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>protected void SignButton_Click(object sender, EventArgs e){  if (FileUpload1.HasFile)  {    ...    // create a new entry in table storage    GuestBookEntry entry = new GuestBookEntry() { GuestName = NameTextBox.Text, Message = MessageTextBox.Text, PhotoUrl = blob.Uri.ToString(), ThumbnailUrl = blob.Uri.ToString() };    GuestBookDataSource ds = new GuestBookDataSource();    ds.AddGuestBookEntry(entry);    System.Diagnostics.Trace.TraceInformation("Added entry {0}-{1} in table storage for guest '{2}'", entry.PartitionKey, entry.RowKey, entry.GuestName);<b>    // queue a message to process the image</b><b>    var queue = queueStorage.GetQueueReference("guestthumbs");</b><b>    var message = new CloudQueueMessage(String.Format("{0},{1},{2}", blob.Uri.ToString(), entry.PartitionKey, entry.RowKey));</b><b>    queue.AddMessage(message);</b><b>    System.Diagnostics.Trace.TraceInformation("Queued message to process blob '{0}'", uniqueBlobName);</b>  }  NameTextBox.Text = "";  MessageTextBox.Text = "";  DataList1.DataBind();}</pre></td></tr></table></span></div><br /><p>(Code Snippet – <i>Introduction to Windows Azure - Ex1 Queueing work items – VB</i>)</p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Protected Sub SignButton_Click(ByVal sender As Object, ByVal e As EventArgs) Handles SignButton.Click  If FileUpload1.HasFile Then    ...    ' create a new entry in table storage    Dim entry As New GuestBookEntry() With {.GuestName = NameTextBox.Text, .Message = MessageTextBox.Text, .PhotoUrl = blob.Uri.ToString(), .ThumbnailUrl = blob.Uri.ToString()}    Dim ds As New GuestBookDataSource()    ds.AddGuestBookEntry(entry)    System.Diagnostics.Trace.TraceInformation("Added entry {0}-{1} in table storage for guest '{2}'", entry.PartitionKey, entry.RowKey, entry.GuestName)<b>    ' queue a message to process the image</b><b>    Dim queue = queueStorage.GetQueueReference("guestthumbs")</b><b>    Dim message = New CloudQueueMessage(String.Format("{0},{1},{2}", blob.Uri.ToString(), entry.PartitionKey, entry.RowKey))</b><b>    queue.AddMessage(message)</b><b>    System.Diagnostics.Trace.TraceInformation("Queued message to process blob '{0}'", uniqueBlobName)</b>  End If  NameTextBox.Text = ""  MessageTextBox.Text = ""  DataList1.DataBind()End Sub</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>The updated code obtains a reference to the “<i>guestthumbs</i>” queue. It constructs a new message that consists of a comma-separated string with the name of the blob that contains the image, the partition key, and the row key of the entity that was added. The worker role can easily parse messages with this format. The method then submits the message to the queue.</td></tr></table><p /></div></li>
        </ol>
        <br />
        <a name="_Toc266620938" href="#">
          <span />
        </a>
        <a name="_Toc278816306" href="#">
          <span />
        </a>
        <p>
          <b>Verification</b>
        </p>
        <p>The Windows Azure compute emulator, formerly Development Fabric or devfabric, is a simulated environment for developing and testing Windows Azure applications in your machine.  In this task, you launch the GuestBook application in the emulator and create one or more guest book entries.</p>
        <p>Among the features available in the Windows Azure Tools for Microsoft Visual Studio is a Windows Azure Storage browser that allows you to connect to a storage account and browse the blobs and tables it contains. If you are using this version of Visual Studio, you will use it during this task to examine the storage resources created by the application.</p>
        <ol>
          <li>Press <b>F5</b> to execute the service. The service builds and then launches the local Windows Azure compute emulator. To show the Compute Emulator UI, right-click its icon located in the system tray and select <b>Show Compute Emulator UI</b>.<p><img src="images\8466fe4e-e5ed-4ab7-98f9-c5d44a00b98d.png" /></p><p><b>Figure 14</b><br /><i>Showing the Compute Emulator UI</i></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>When you use the storage emulator for the first time, it needs to execute a one-time initialization procedure to create the necessary database and tables. If this is the case, wait for the procedure to complete and examine the <b>Development Storage Initialization</b> dialog to ensure that it completes successfully.</td></tr></table><p /></div><br /><p><img src="images\f2414798-ebb5-419e-9f0c-0901d5071abb.png" /></p><p><b>Figure 15</b><br /><i>Storage emulator initialization process</i></p><br /></li>
          <li>Switch to Internet Explorer to view the GuestBook application.</li>
          <li>Add a new entry to the guest book. To do this, type your name and a message, choose an image to upload, and then click the pencil icon to submit the entry.<p><img src="images\e156f056-2d6e-4e60-85a3-efa5c295f243.png" /></p><p><b>Figure 16</b><br /><i>Windows Azure GuestBook home page</i></p><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> It is a good idea to choose a large hi-resolution image because, once the application is complete, the guestbook service will resize uploaded images.</td></tr></table><p /></div><br /><p>Once you submit an entry, the web role creates a new entity in the guest book table and uploads the photo to blob storage. The page contains a timer that triggers a page refresh every 5 seconds, so the new entry should appear on the page after a brief interval. Initially, the new entry contains a link to the blob that contains the uploaded image so it will appear with the same size as the original image. </p><p><img src="images\ac17cf93-bd66-410f-992a-1385202bb013.png" /></p><p><b>Figure 17</b><br /><i>GuestBook application showing an uploaded image in its original size</i></p><br /><p>If you are using Visual Studio 2010, you can use the Windows Azure Storage Explorer to view storage resources directly from Visual Studio. This functionality is not available in Visual Studio 2008.</p></li>
          <li>To open the Storage Explorer in Visual Studio 2010, open the <b>View</b> menu, select <b>Server Explorer</b>, and then expand the <b>Windows Azure Storage</b> node.<p>The <b>Windows Azure Storage</b> node lists the storage accounts that you have currently registered and, by default, includes an entry for the storage emulator account labeled as <b>(Development)</b>.</p><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>Windows Azure Storage Explorer is not available in Visual Studio 2008.</td></tr></table><p /></div><br /></li>
          <li>Expand the <b>(Development)</b> node and then the <b>Tables</b> node inside it.  Notice that it contains a table named <i>GuestBookEntry</i> created by the application that should contain details for each entry.<p><img src="images\9c3fe120-7dba-4b99-96ee-8aea88c4c48d.png" /></p><p><b>Figure 18</b><br /><i>Viewing tables in the Windows Azure storage emulator</i></p><br /></li>
          <li>Double-click the <i>GuestBookEntry</i> node in the <b>Windows Azure Storage</b> explorer to show the contents of this table. The <i>GuestBookEntry</i> table contains information for the entry that you created earlier in this task, including its <i>GuestName</i>, <i>Message</i>, <i>PhotoUrl</i>, and <i>ThumbnailUrl</i> properties, as well as the <i>PartitionKey</i>, <i>RowKey</i>, and <i>Timestamp</i> properties common to all table storage entities. Notice that the <i>PhotoUrl</i> and <i>ThumbnailUrl</i> properties are currently the same. In the next exercise, you will modify the application to generate image thumbnails and to update the corresponding URL.<p><img src="images\e394cbb9-9d72-4fbe-b941-cc3bcf7a02b6.png" /></p><p><b>Figure 19</b><br /><i>Viewing tables using the Windows Azure Tools for Visual Studio</i></p><br /></li>
          <li>Now, expand the <b>Blobs</b> node in the <b>Windows Azure Storage</b> explorer. Inside this node, you will find an entry for a container named <i>guestbookpics</i> that contains blobs with raw data for the images uploaded by the application. <p><img src="images\97d42bfa-b8f9-4f19-bf65-041c3214d944.png" /></p><p><b>Figure 20</b><br /><i>Viewing blobs using the Windows Azure Tools for Visual Studio</i></p><br /></li>
          <li>Double-click the node for the <i>guestbookpics</i> container to list the blobs it contains. It should include an entry for the image that you uploaded earlier.<p><img src="images\e025460a-fe08-47ed-bb1e-e8aeb1df811c.png" /></p><p><b>Figure 21</b><br /><i>Viewing the contents of a blob container in Visual Studio</i></p><br /></li>
          <li>Each blob in blob storage has an associated content type that Visual Studio uses to select a suitable viewer for the blob. To display the contents of the blob, double-click the corresponding entry in the container listing to display the image.<p><img src="images\888443e2-5d6f-4322-9ddf-f29513fab09a.png" /></p><p><b>Figure 22</b><br /><i>Viewing blob contents in Visual Studio</i></p><br /></li>
          <li>Press <b>SHIFT + F5</b> to stop the debugger and shut down the deployment in the development fabric.</li>
        </ol>
        <br />
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to VSKitFdbk@Microsoft.com<p />Copyright © 2011 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>