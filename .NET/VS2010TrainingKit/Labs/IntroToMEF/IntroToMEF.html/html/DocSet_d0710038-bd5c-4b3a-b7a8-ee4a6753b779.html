<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Exercise 1: Using MEF to Extend an Application" />
      <MSHelp:RLTitle Title="Exercise 1: Using MEF to Extend an Application" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Exercise 1: Using MEF to Extend an Application</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/javascript" language="jscript"> </script>
    <script src="../local/script.js" type="text/javascript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">Introduction To Managed Extensibility Framework</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Exercise 1: Using MEF to Extend an Application</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
      <table width="100%" id="bottomTable" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <span onclick="ExpandCollapseAll(toggleAllImage)" onkeypress="ExpandCollapseAll_CheckKey(toggleAllImage)" tabindex="0" style="cursor:default;display:none;">
              <img id="toggleAllImage" class="toggleAll" alt="CollapseAll image" src="../local/collall.gif" />
              <label id="collapseAllLabel" for="toggleAllImage" style="display: none;">Collapse All</label>
              <label id="expandAllLabel" for="toggleAllImage" style="display: none;">Expand All</label> </span>
            <span id="languageFilterToolTip" onmouseover="languageFilterImage.src=dropDownHoverImage.src;" onmouseout="languageFilterImage.src=dropDownImage.src;" tabindex="0" style="cursor:default;">
              <img id="languageFilterImage" alt="DropDown image" src="../local/drpdown.gif" />
              <label id="showAllLabel" for="languageFilterImage" style="display: none;">Language Filter: All</label>
              <label id="multipleLabel" for="languageFilterImage" style="display: none;">Language Filter: Multiple</label>
              <label id="vbLabel" for="languageFilterImage" style="display: none;">Language Filter: Visual Basic</label>
              <label id="csLabel" for="languageFilterImage" style="display: none;">Language Filter: C#</label>
            </span>
          </td>
        </tr>
      </table>
      <div id="languageSpan">
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="vbUsageCheckbox" />
        <label class="languageFilter" for="vbUsageCheckbox">Visual Basic Usage</label>
        <br />
        <input type="checkbox" name="languageFilter" onclick="SetLanguage(this)" id="csCheckbox" />
        <label class="languageFilter" for="csCheckbox">C#</label>
        <br />
      </div>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <p>One practical use of the Managed Extensibility Framework is adding modules to an application at runtime. This is useful in a scenario in which users chooses specific modules to purchase or install originally and may add more modules at a later time. Using MEF, you can configure your application to monitor a well-known directory and add any module assemblies found in that directory. Dropping module assemblies into a directory allows your application to load those assemblies without explicitly setting references to them.</p>
        <br />
        <a name="_Toc209425732" href="#">
          <span />
        </a>
        <a name="_Toc281932541" href="#">
          <span />
        </a>
        <p>
          <b>Task 1 – Updating Your Application to Load Composable Parts</b>
        </p>
        <p>In this task, you will modify an existing WPF Window class to create extension hooks that will allow dynamically importing queries. You will update this query classes later in this exercise. </p>
        <ol>
          <li>Open Microsoft Visual Studio 2010 from <b>Start</b> | <b>All Programs</b> | <b>Microsoft Visual Studio 2010</b> | <b>Microsoft Visual Studio 2010</b>.</li>
          <li>Open the <b>ContosoAutomotive.sln</b> solution file. By default, this file is located in the folder <b><i>Source\Ex1\begin</i>(choosing the folder that matches the language of your preference.)</b></li>
          <li>Add a reference to the MEF library on the <b>ContosoAutomotive</b> project. To do this:<ol><li>Select the <b>ContosoAutomotive</b> project in the <b>Solution Explorer</b> and select <b>Project | Add Reference</b>…  The <b>Add References</b> dialog appears.  </li><li>Select the <b>.NET</b> tab and then select the <b>System.ComponentModel.Composition</b> component. Click the <b>OK</b> button to add a reference to this library.<p><img src="images\de4dc412-71c8-41d9-8402-79da463f2f89.png" /></p><p><b>Figure 1</b><br /><i>Add a Reference to the MEF library.</i></p><br /></li></ol></li>
          <li>Open the App class in code view. To do this, right-click on the <b>App.xaml</b> file in the Solution Explorer and select <b>View Code</b>.</li>
          <li>Update the App class to use the MEF library. To do this, add the following statement on top of the using clause list above the <b>App</b> class definition.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using System.ComponentModel.Composition.Hosting;</b></pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports System.ComponentModel.Composition.Hosting</b></pre></td></tr></table></span></div><br /></li>
          <li>Create an aggregate catalog to load parts from the current application assembly and from assemblies located in the current folder in the file system. Also, create a composition container instance based on it and create an exported CashMaker instance. To do this, modify the <b>AppStartup</b> method with the following code.<p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task1 Step6 - StartupCatalogAndContainer CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>void AppStartup(object sender, StartupEventArgs args){<b>    var catalog = new AggregateCatalog(new DirectoryCatalog("."),</b><b>                new AssemblyCatalog(Assembly.GetExecutingAssembly()));</b><b>    var container = new CompositionContainer(catalog);</b><b>    var window = container.GetExportedValue&lt;CashMaker&gt;();</b>    window.Show();}</pre></td></tr></table></span></div><br /><p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task1 Step6 - StartupCatalogAndContainer VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Sub AppStartup(ByVal sender As Object, ByVal args As StartupEventArgs){<b>    Dim catalog = New AggregateCatalog(New DirectoryCatalog("."),</b><b>                New AssemblyCatalog(Assembly.GetExecutingAssembly()))</b><b>    Dim container = New CompositionContainer(catalog)</b><b>    Dim window = container.GetExportedValue(Of CashMaker)()</b>    window.Show()}</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> The starting point for enabling MEF composability is creating a composition container based on one or several catalogs. MEF's container interacts with <b>Catalogs</b> to have access to composable parts. The container itself resolves a part's dependencies and exposes Exports to the outside world. In addition, you are free to add composable part instances directly to the container if you wish.</td></tr></table><p /></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td>There are different kinds of Catalogs, which are able to discover parts on different ways. This exercise uses an Aggregate Catalog combining a Directory Catalog searching on the Application directory (represented by the “.”) and Assembly Catalog for look at the types inside the application assembly (retrieved using the Assembly.GetExecutingAssembly method). <br />The full list of Catalogs available on MEF is:<br /><b>-  Assembly Catalog:</b> Discovers the different parts on a specific assembly.<br /><b>-  Directory Catalog:</b> Discovers parts inside the assemblies on a specific directory.<br /><b>-  Aggregate Catalog:</b> Allows use more than one catalog combining them.<br /><b>-  Type Catalog: </b>Looks inside the assemblies for specific types.<br />For more information on Catalogs, see <a href="http://mef.codeplex.com/wikipage?title=Using catalogs">Using catalogs</a>.</td></tr></table><p /></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> Application’s main window is also located and loaded using MEF through the container’s  <b>GetExportedValue</b> method. In the following steps, you will decorate the <b>CashMaker</b> class (which is the main window) with the <b>Export</b> attribute to be discoverable by MEF.<br />The <b>GetExportedValue</b> method will throw an exception if no parts or more than one implement the solicited contract. This is not a problem in the exercise implementation because we are not using an interface to discover the type, we are using the class itself so it has to be defined and cannot be duplicated, ensuring that MEF will find only one instance.</td></tr></table><p /></div><br /></li>
          <li>Open the CashMaker Window in code view. To do this, right-click on the <b>CashMaker.xaml</b> file in the Solution explorer and select <b>View Code</b>.</li>
          <li>Update the CashMaker class to use the MEF library. To do this, add the following statement at the top of the <b>CashMaker</b> class definition.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using System.ComponentModel.Composition;</b></pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports System.ComponentModel.Composition</b></pre></td></tr></table></span></div><br /></li>
          <li>Since the CashMaker class is now a composable part you will export the class making it available to the composition container. To do this, decorate the <b>CashMaker</b> class with the <b>Export</b> attribute as shown in the code below.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>[Export]</b>public partial class CashMaker : Window{...}</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>&lt;Export()&gt;</b>Class CashMaker    Inherits Window...End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td><b>NOTE: Import</b> and <b>Export</b> values are interconnected with unique Contracts.  Contracts serve as uni-directional bridges. An export contract can consist of further metadata used to filter on its discovery. For example, it might indicate a specific capability that the export offers.<br />As you decorate the <b>CashMaker</b> class with the <b>Export</b> attribute, it will discover composable parts exporting the <b>ICarQuery</b> contract, defined in the <b>ContosoAutomotive.Common</b> project. You will declare a collection to hold the <b>Imports</b> and expose them through a property. MEF's composition container will resolve applicable <b>Exports</b> and <b>Imports</b> loading the collection for you.</td></tr></table><p /></div><br /></li>
          <li> Add the following code to the <b>CashMaker.xaml.cs</b> (C#) or <b>CashMaker.xaml.vb</b> (Visual Basic) file, just above its constructor.<p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task1 Step10 - ImportedCarQueries CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>[ImportMany(AllowRecomposition = true)]</b><b>public ObservableCollection&lt;ICarQuery&gt; CarQueries { get; set; }</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task1 Step10 - ImportedCarQueries VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>&lt;ImportMany(AllowRecomposition:=True)&gt;</b><b>Public Property CarQueries() As ObservableCollection(Of ICarQuery)</b></pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> You can import collections with the <b>ImportMany</b> attribute. This means that all instances of the specific contract will be imported from the container.<br />MEF parts can also support recomposition. This means that as new exports become available in the container, collections are automatically updated with the new set.</td></tr></table><p /></div><br /></li>
          <li>Once MEF completes the CarQueries collection import process, you want your application to be notified and so it can take a particular action. To do this, make the CashMaker class to implement the IPartImportsSatisfiedNotification interface as shown in the following code.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>[Export]public partial class CashMaker : Window, IPartImportsSatisfiedNotification{...}</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>&lt;Export&gt;Public Partial Class CashMaker    Inherits Window<b>    Implements IPartImportsSatisfiedNotification</b>...End Class</pre></td></tr></table></span></div><br /></li>
          <li>Implement the IPartImportsSatisfiedNotification interface and bind the CarQueries collection to the UI by setting the DataContext property of the commandGrid control. To do this, paste the following <b>OnImportsSatisfied</b> method code inside the CashMaker class.<p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task1 Step12 - OnImportsSatisfied CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>public void OnImportsSatisfied()</b><b>{</b><b>    this.commandGrid.DataContext = this.CarQueries;</b><b>}</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task1 Step 12 - OnImportsSatisfied VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Public Sub OnImportsSatisfied() Implements IPartImportsSatisfiedNotification. OnImportsSatisfied</b><b>    Me.commandGrid.DataContext = Me.CarQueries</b><b>End Sub</b></pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> After MEF’s Container fills the different imports inside the class, it calls the OnImportsSatisfied method if the class implements the <b>IPartImportsSatisfiedNotification</b> interface. This method is used as a notification when the container has filled all the imports. It is also called after a recomposition occurs.</td></tr></table><p /></div><br /></li>
          <li>Now you can remove the old code used to explicitly create and bind the query instances. To do this, in the CashMaker constructor remove the code used to populate the commandGrid.DataContext property as shown below.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>public CashMaker(){    this.InitializeComponent();    new Thread(() =&gt; this.GenerateCars()).Start();    // Removed code}</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>Public Sub New()    Me.InitializeComponent()    Dim thread = New Thread(() =&gt; Me.GenerateCars())    thread.Start()    ' Removed codeEnd Sub</pre></td></tr></table></span></div><br /></li>
        </ol>
        <a name="_Toc209425733" href="#">
          <span />
        </a>
        <a name="_Toc281932542" href="#">
          <span />
        </a>
        <p>
          <b>Task 2 – Updating Your Composable Part to Export Contracts</b>
        </p>
        <p>In this task, you will modify an existing Windows Class Library project with services classes to query a collection of cars. You will use MEF to mark the queries to export a contract to another application.</p>
        <ol>
          <li>Add a reference to the MEF library on the <b>ContosoAutomotive.Extensions</b> project. To do this:<ol><li>Select the <b>ContosoAutomotive.Extensions</b> project in the <b>Solution Explorer</b> and select <b>Project | Add Reference</b>…  The <b>Add References</b> dialog appears.</li><li>Select the <b>.NET</b> tab and then select the <b>System.ComponentModel.Composition</b> component. Click the <b>OK</b> button to add a reference to this library.<p><img src="images\16e4c94f-ce0d-4677-b6a6-3cad578677cb.png" /></p><p><b>Figure 1</b><br /><i>Add a Reference to the MEF library.</i></p><br /></li></ol></li>
          <li>Open the <b>CohoQuery.cs</b> file (for Visual C# projects) or <b>CohoQuery.vb </b>file (for Visual Basic projects) in the <b>ContosoAutomotive.Extensions</b> project. Add the following namespace declaration to import the types contained in the MEF library at the top of the <b>CohoQuery</b> class definition.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using System.ComponentModel.Composition;</b></pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports System.ComponentModel.Composition</b></pre></td></tr></table></span></div><br /></li>
          <li>The <i>CohoQuery</i> class is one of several parts available in your application. Take into account that you used the <i>ImportMany</i> attribute in the <i>CashMaker</i> class to pull in only components that implement the <b>ICarQuery</b> contract. You will decorate the CohoQuery class indicating that it matches that contract.  To do this, decorate the <b>CohoQuery</b> class with the <b>Export</b> attribute as shown in the code below:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>[Export(typeof(ICarQuery))]</b>public class CohoQuery : CarQueryBase{...}</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>&lt;Export(GetType(ICarQuery))&gt;</b>Public Class CohoQuery    Inherits CarQueryBase...End Class</pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> You are using the <b>Export</b> attribute to define that the <b>CohoQuery</b> class is a part of the application and it implements the <b>ICarQuery</b> contract, which is the type that the import property inside the <b>CashMaker</b> class will look for.</td></tr></table><p /></div><br /></li>
          <li>Now, you will apply the same changes to the FabrikamQuery class. To do this, open the <b>FabrikamQuery.cs</b> file (for Visual C# projects) or <b>FabrikamQuery.vb </b>file (for Visual Basic projects) in the <b>ContosoAutomotive.Extensions</b> project. Add the following namespace declaration to import the types contained in the MEF library at the top of the FabrikamQuery class definition.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using System.ComponentModel.Composition;</b></pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports System.ComponentModel.Composition</b></pre></td></tr></table></span></div><br /></li>
          <li>You will decorate the FabrikamQuery class indicating that it matches the ICarQuery contract.  To do this, decorate the <b>FabrikamQuery </b>class with the <b>Export</b> attribute as shown in the code below:<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>[Export(typeof(ICarQuery))]</b>public class FabrikamQuery : CarQueryBase{...}</pre></td></tr></table></span></div><br /><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>&lt;Export(GetType(ICarQuery))&gt;</b>Public Class FabrikamQuery    Inherits CarQueryBase...End Class</pre></td></tr></table></span></div><br /></li>
          <li>At this point, you can start a new instance of the ContosoAutomotive project to check that the two queries are shown in the UI. To do this, right click the <b>ContosoAutomotive</b> project and select <b>Debug</b> | <b>Start new instance</b>.<p><img src="images\976ff9b6-4009-4bfd-8955-37a3d6668496.png" /></p><p><b>Figure 1</b><br /><i>MEF loaded queries in ContosoAutomotive application.</i></p><br /></li>
          <li>To verify the MEF extensibility, you will add several pre-built query classes. To do this, right-click <b>ContosoAutomotive.Extensions </b>in <b>Solution Explorer</b>, point to <b>Add</b> and select <b>Existing Item</b>. In the <b>Add Existing Item</b> dialog, browse to the <b>ContosoAutomotive.Extensions</b> in <b>Source\Assets</b> for the language of your project, hold the <b>CTRL</b> key down while you select every file in this folder and click <b>Add</b>.<p><img src="images\411a62c3-82d6-4f2c-9b40-163cb75c2b09.png" /></p><p><b>Figure 2</b><br /><i>Added new queries in ContosoAutomotive.Extensions project (C#)</i></p><br /><p><img src="images\d66cd103-e2aa-4f42-b2c3-1d46918d6764.png" /></p><p><b>Figure 3</b><br /><i>Added new queries in ContosoAutomotive.Extensions project (Visual Basic)</i></p><br /></li>
          <li>At this point, you can start a new instance of the ContosoAutomotive project to check that the two queries are shown in the UI. To do this, right click the <b>ContosoAutomotive</b> project and select <b>Debug</b> | <b>Start new instance</b>.<p><img src="images\9d0d2c63-d7ad-40ee-91d5-f0b3f78a3c65.png" /></p><p><b>Figure 4</b><br /><i>MEF loaded queries in ContosoAutomotive application</i></p><br /></li>
        </ol>
        <a name="_Toc281932543" href="#">
          <span />
        </a>
        <p>
          <b>Task 3 – Creating a New Extension </b>
        </p>
        <p>In this task, you will create a new application extension with a query services class. You will use MEF to Export contracts and a build action to avoid references between projects. Additionally, you can mix CLR languages and create the new project in different CLR language than your main application.</p>
        <ol>
          <li>Create a new application extension project named Woodgrove. To do this, right click the solution node in the Solution Explorer and select <b>Add</b> | <b>New Project. </b>In the Add New Project dialog select <b>Windows Class Library</b> project type and name it <b>ContosoAutomotive.Woodgrove</b>.<p><img src="images\f3d983d6-4471-4451-8e65-d3bdeb72edb5.png" /></p><p><b>Figure 5</b><br /><i>New Woodgrove extension project (C#)</i></p><br /><p><img src="images\074b1dfa-3e8b-4104-8ea6-5cfb0700ee38.png" /></p><p><b>Figure 6</b><br /><i>New Woodgrove extension project (Visual Basic)</i></p><br /></li>
          <li>Delete the default class file <b>Class1.cs</b> (C#) or <b>Class1.vb</b> (Visual Basic).</li>
          <li>Add a reference to the MEF library on the <b>ContosoAutomotive.Woodgrove</b> project. To do this:<ol><li>Select the <b>ContosoAutomotive.Woodgrove</b> project in the <b>Solution Explorer</b> and select <b>Project | Add Reference</b>…  The <b>Add References</b> dialog appears.</li><li>Select the <b>.NET</b> tab and then select the <b>System.ComponentModel.Composition</b> component. Click the <b>OK</b> button to add a reference to this library.<p><img src="images\9b8d7aca-10ed-46de-8b01-e859c709b164.png" /></p><p><b>Figure 1</b><br /><i>Add a Reference to the MEF library.</i></p><br /></li></ol></li>
          <li>Add a reference to the ContosoAutomotive.Common library on the <b>ContosoAutomotive.Woodgrove</b> project. To do this:<ol><li>Select the <b>ContosoAutomotive.Woodgrove</b> project in the <b>Solution Explorer</b> and select <b>Project | Add Reference</b>…  The <b>Add References</b> dialog appears.</li><li>Select the <b>Projects</b> tab and then select the <b>ContosoAutomotive.Common</b> component. Click the <b>OK</b> button to add a reference to this library.<p><img src="images\af185389-f004-4192-addd-cc11a8114fb9.png" /></p><p><b>Figure 1</b><br /><i>Add a Reference to the ContosoAutomotive.Common library.</i></p><br /></li></ol></li>
          <li>Create a new class named WoodgroveQuery. To do this, right click the ContosoAutomotive.Woodgrove project and select <b>Add</b> | <b>Class</b> and name it <b>WoodgroveQuery</b>.</li>
          <li>Open the <b>WoodgroveQuery.cs</b> file (for Visual C# projects) or <b>WoodgroveQuery.vb</b> file (for Visual Basic projects) in the <b>ContosoAutomotive.Woodgrove </b>project. Add the following namespace declaration to import the types contained in the MEF library at the top of the <b>WoodgroveQuery</b> class definition.<p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task3 Step6 – WoodgroveQueryNamespaces CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>using System.ComponentModel.Composition;</b><b>using ContosoAutomotive.Common;</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task3 Step6 - WoodgroveQueryNamespaces VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>Imports System.Collections.Generic</b><b>Imports System.ComponentModel.Composition</b><b>Imports ContosoAutomotive.Common</b></pre></td></tr></table></span></div><br /></li>
          <li>The <i>WoodgroveQuery</i>class matches the same contract and implements the same interface as the previous modified classes. You will implement a new query class similar to the previous one. To do this, replace the class implementation with the following code.<p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task3 Step7 - WoodgroveQueryClass CSharp)</i></p><div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>[Export(typeof(ICarQuery))]</b><b>public class WoodgroveQuery : CarQueryBase</b><b>{</b><b>    public WoodgroveQuery()</b><b>    {</b><b>        this.Name = "Woodgrove Cycles";</b><b>        this.Description = "Who doesn't love a Woodgrove? The fastest thing on two wheels!";</b><b>        this.ImagePath = "Images/woodgrove.jpg";</b><b>    }</b><b>    protected override IEnumerable&lt;Car&gt; RunQuery(IEnumerable&lt;Car&gt; cars)</b><b>    {</b><b>        var results = from c in cars</b><b>                      where c.Make == "Woodgrove"</b><b>                      &amp;&amp; c.Price &gt;= 50000</b><b>                      &amp;&amp; c.Year &gt;= 2000</b><b>                      &amp;&amp; c.Transmission == Transmission.Manual</b><b>                      &amp;&amp; c.SatelliteRadio == true</b><b>                      &amp;&amp; c.Mpg &gt;= 20</b><b>                      &amp;&amp; c.Interior == InteriorType.Suede</b><b>                      &amp;&amp; c.MoonRoof == false</b><b>                      &amp;&amp; c.Mileage &lt;= 40000</b><b>                      select c;</b><b>        return results;</b><b>    }</b><b>}</b></pre></td></tr></table></span></div><br /><p><i>(Code Snippet – Intro to MEF Lab - Ex1 Task3 Step7 - WoodgroveQueryClass VB)</i></p><div class="code"><span codeLanguage="VisualBasicUsage"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Visual Basic</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>&lt;Export(GetType(ICarQuery))&gt;</b><b>Public Class WoodgroveQuery</b><b>    Inherits CarQueryBase</b><b>    Public Sub New()</b><b>        Me.Name = "Woodgrove Cycles"</b><b>        Me.Description = "Who doesn't love a Woodgrove? The fastest thing on two wheels!"</b><b>        Me.ImagePath = "Images/woodgrove.jpg"</b><b>    End Sub</b><b>    Protected Overrides Function RunQuery(ByVal cars As IEnumerable(Of Car)) As IEnumerable(Of Car)</b><b>        Dim results = From c In cars _</b><b>                          Where c.Make = "Woodgrove" _</b><b>                          AndAlso c.Price &gt;= 50000 _</b><b>                          AndAlso c.Year &gt;= 2000 _</b><b>                          AndAlso c.Transmission = Transmission.Manual _</b><b>                          AndAlso c.SatelliteRadio = True _</b><b>                          AndAlso c.Mpg &gt;= 20 _</b><b>                          AndAlso c.Interior = InteriorType.Suede _</b><b>                          AndAlso c.MoonRoof = False _</b><b>                          AndAlso c.Mileage &lt;= 40000</b><b>        Return results</b><b>    End Function</b><b>End Class</b></pre></td></tr></table></span></div><br /></li>
          <li>For the new extension project to be discoverable by the catalog, you should place the assembly in the same folder as the main application. You can achieve this in the development environment by configuring the build events. To do this, right click on the <b>ContosoAutomotive.Woodgrove</b> project and select <b>Properties</b>. In the Properties page, select the <b>Build Events tab</b> (for C# projects) or select the <b>Compile tab</b> and press the <b>Build Events…</b> button (for Visual Basic projects) and enter the following value in the <b>Post-build event command line</b>:<div class="code"><span codeLanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>Post-Build Command</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre><b>copy "$(TargetPath)" "$(SolutionDir)ContosoAutomotive\bin\$(ConfigurationName)"</b></pre></td></tr></table></span></div><br /><div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif" />Note:</th></tr><tr><td> MEF’s Container will be able to discover the application parts inside the new assembly since you are copying it to the application directory, and a Directory Catalog is looking at it.</td></tr></table><p /></div><br /></li>
        </ol>
        <h1 class="heading">Next Step</h1>
        <p>
          <a href="docSet_261ffd29-4862-46cc-90b6-788c58b8862d.html">Exercise 1: Verification</a>
        </p>
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to VSKitFdbk@Microsoft.com<p />Copyright © 2011 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>